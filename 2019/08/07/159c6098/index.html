<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="Tadow çš„åšå®¢">
    <meta property="og:type" content="website">
    <meta name="description" content="Tadow çš„åšå®¢">
    <meta name="keyword"  content="Tadow, Resolmi, imlgw, åŠå²›é“ç›’, ç®—æ³•, Java, Golang">
    <link rel="shortcut icon" href="https://fav.farm/ğŸ’­">

    <title>
        
        é˜»å¡é˜Ÿåˆ— - Tadow ç¢ç¢å¿µ
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Tadow ç¢ç¢å¿µ" type="application/atom+xml">
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Keep It Simple, Stupid </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="https://static.imlgw.top/blog/20220821160037.png" />
        </div>
        <div class="name">
            <i>Tadow</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <!-- <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>æ ‡ç­¾</span>
                </a>
            </li> -->
            <li >
                <a href="/categories">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>å­˜æ¡£</span>
                </a>
            </li>
            
            <li >
                <a href="/selfhosted">
                    <i class="iconfont icon-guidang1"></i>
                    <span>è‡ªå»º</span>
                </a>
            </li>

            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>æ”¶è—</span>
                </a>
            </li>

            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>å…³äº</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>æœç´¢</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97"><span class="toc-text">é˜»å¡é˜Ÿåˆ—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-%E9%87%8C%E7%9A%84%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97"><span class="toc-text">Java é‡Œçš„é˜»å¡é˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ArrayBlockingQueue"><span class="toc-text">ArrayBlockingQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedBlockingQueue"><span class="toc-text">LinkedBlockingQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PriorityBlockingQueue"><span class="toc-text">PriorityBlockingQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DelayQueue"><span class="toc-text">DelayQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SynchronousQueue"><span class="toc-text">SynchronousQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedTransferQueue"><span class="toc-text">LinkedTransferQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedBlockingDeque"><span class="toc-text">LinkedBlockingDeque</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">å‚è€ƒ</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">æœç´¢</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Keep It Simple, Stupid </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        é˜»å¡é˜Ÿåˆ—
    </div>

    <div class="post-meta">
        <span class="attr">å‘å¸ƒäºï¼š<span>2019-08-07 00:00:00</span></span>
        
        <span class="attr">æ ‡ç­¾ï¼š/
        
        <a class="tag" href="/tags/#å¤šçº¿ç¨‹" title="å¤šçº¿ç¨‹">å¤šçº¿ç¨‹</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#å¹¶å‘ç¼–ç¨‹" title="å¹¶å‘ç¼–ç¨‹">å¹¶å‘ç¼–ç¨‹</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">è®¿é—®ï¼š<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h2 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h2><p>é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚</p>
<p><strong>éé˜»å¡é˜Ÿåˆ—ä¸­çš„å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š</strong></p>
<ul>
<li><p><code>add(E e)</code>: å°†å…ƒç´  e æ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p>
</li>
<li><p> <code>remove()</code>: ç§»é™¤é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥ç§»é™¤æˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦‚æœç§»é™¤å¤±è´¥ï¼ˆé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p>
</li>
<li><p><code>offer(E e)</code>ï¼šå°†å…ƒç´  e æ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™è¿”å› false</p>
</li>
<li><p><code>poll()</code>ï¼šç§»é™¤å¹¶è·å–é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å› null</p>
</li>
<li><p><code>peek()</code>ï¼šè·å–é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å› null</p>
</li>
</ul>
<p>å¯¹äºéé˜»å¡é˜Ÿåˆ—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨ offerã€poll å’Œ peek ä¸‰ä¸ªæ–¹æ³•ï¼Œä¸å»ºè®®ä½¿ç”¨ add å’Œ remove æ–¹æ³•ã€‚å› ä¸ºä½¿ç”¨ offerã€poll å’Œ peek ä¸‰ä¸ªæ–¹æ³•å¯ä»¥é€šè¿‡è¿”å›å€¼åˆ¤æ–­æ“ä½œæˆåŠŸä¸å¦ï¼Œè€Œä½¿ç”¨ add å’Œ remove æ–¹æ³•å´ä¸èƒ½è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚æ³¨æ„ï¼Œéé˜»å¡é˜Ÿåˆ—ä¸­çš„æ–¹æ³•éƒ½æ²¡æœ‰è¿›è¡ŒåŒæ­¥æªæ–½ã€‚</p>
<p><strong>é˜»å¡é˜Ÿåˆ—ä¸­çš„å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š</strong></p>
<p>é˜»å¡é˜Ÿåˆ—åŒ…æ‹¬äº†éé˜»å¡é˜Ÿåˆ—ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œä¸Šé¢åˆ—ä¸¾çš„ 5 ä¸ªæ–¹æ³•åœ¨é˜»å¡é˜Ÿåˆ—ä¸­éƒ½å­˜åœ¨ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™ 5 ä¸ªæ–¹æ³•åœ¨é˜»å¡é˜Ÿåˆ—ä¸­éƒ½è¿›è¡Œäº†<strong>åŒæ­¥æªæ–½</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé˜»å¡é˜Ÿåˆ—æä¾›äº†å¦å¤– 4 ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li><p><code>put(E e)</code>æ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…</p>
</li>
<li><p><code>take()</code>æ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ç­‰å¾…</p>
</li>
<li><p><code>offer(E e,long timeout, TimeUnit unit)</code>æ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ’å…¥æˆåŠŸï¼Œåˆ™è¿”å› falseï¼›å¦åˆ™è¿”å› true</p>
</li>
<li><p><code>poll(long timeout, TimeUnit unit)</code>æ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ç©ºï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœæ²¡å–åˆ°ï¼Œåˆ™è¿”å› nullï¼›å¦åˆ™è¿”å›å–å¾—çš„å…ƒç´ </p>
</li>
</ul>
<h3 id="Java-é‡Œçš„é˜»å¡é˜Ÿåˆ—"><a href="#Java-é‡Œçš„é˜»å¡é˜Ÿåˆ—" class="headerlink" title="Java é‡Œçš„é˜»å¡é˜Ÿåˆ—"></a>Java é‡Œçš„é˜»å¡é˜Ÿåˆ—</h3><ul>
<li><strong>ArrayBlockingQueue</strong> ï¼šä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>LinkedBlockingQueue</strong> ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>PriorityBlockingQueue</strong> ï¼šä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>DelayQueue</strong>ï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>SynchronousQueue</strong>ï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>LinkedTransferQueue</strong>ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>LinkedBlockingDeque</strong>ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</li>
</ul>
<blockquote>
<p>é™¤äº†è¿™å‡ ä¸ªå¤–è¿˜æœ‰ä¸€ä¸ª <code>ScheduledThreadPoolExecutor.DelayedWorkQueue</code>è¿™ä¸ªå…¶å®æ˜¯ DelayQueue çš„ä¼˜åŒ–</p>
</blockquote>
<h3 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a>ArrayBlockingQueue</h3><p>ArrayBlockingQueue æ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯è®¿é—®è€…å…¬å¹³çš„è®¿é—®é˜Ÿåˆ—ï¼Œæ‰€è°“å…¬å¹³è®¿é—®é˜Ÿåˆ—æ˜¯æŒ‡é˜»å¡çš„æ‰€æœ‰ç”Ÿäº§è€…çº¿ç¨‹æˆ–æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå½“é˜Ÿåˆ—å¯ç”¨æ—¶ï¼Œå¯ä»¥æŒ‰ç…§é˜»å¡çš„å…ˆåé¡ºåºè®¿é—®é˜Ÿåˆ—ï¼Œå³å…ˆé˜»å¡çš„ç”Ÿäº§è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆå¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œå…ˆé˜»å¡çš„æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ ã€‚é€šå¸¸æƒ…å†µä¸‹ä¸ºäº†ä¿è¯å…¬å¹³æ€§ä¼šé™ä½ååé‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªå…¬å¹³çš„é˜»å¡é˜Ÿåˆ—ï¼š</p>
<p><code>ArrayBlockingQueue fairQueue = new ArrayBlockingQueue(1000,true);</code></p>
<p>è®¿é—®è€…çš„å…¬å¹³æ€§æ˜¯ä½¿ç”¨å¯é‡å…¥é”å®ç°çš„</p>
<h3 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h3><p>LinkedBlockingQueue æ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„<strong>æœ‰ç•Œ</strong>é˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</p>
<p>å®¹æ˜“è¢«è¯¯è§£ä¸ºæ— è¾¹ç•Œï¼Œä½†å…¶å®å…¶è¡Œä¸ºå’Œå†…éƒ¨ä»£ç éƒ½æ˜¯åŸºäºæœ‰ç•Œçš„é€»è¾‘å®ç°çš„ï¼Œåªä¸è¿‡å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶å°±æŒ‡å®šå®¹é‡ï¼Œé‚£ä¹ˆå…¶å®¹é‡é™åˆ¶å°±è‡ªåŠ¨è¢«<br>è®¾ç½®ä¸º Integer.MAX_VALUE ï¼Œæˆä¸ºäº†æ— ç•Œé˜Ÿåˆ—ã€‚</p>
<h3 id="PriorityBlockingQueue"><a href="#PriorityBlockingQueue" class="headerlink" title="PriorityBlockingQueue"></a>PriorityBlockingQueue</h3><p>PriorityBlockingQueue æ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜Ÿåˆ—ã€‚åº•å±‚é‡‡ç”¨æ•°ç»„å®ç°äº†äºŒå‰å †ï¼Œç›¸æ¯” PriorityQueue å…¶å®å°±æ˜¯å°†é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡å–è‡ªç„¶é¡ºåºæ’åˆ—ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¯”è¾ƒå™¨ comparator æ¥æŒ‡å®šå…ƒç´ çš„æ’åºè§„åˆ™ã€‚</p>
<h3 id="DelayQueue"><a href="#DelayQueue" class="headerlink" title="DelayQueue"></a>DelayQueue</h3><p>è¿™ä¸ªé˜Ÿåˆ—è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼ŒDelayQueue æ˜¯ä¸€ä¸ªæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚å†…éƒ¨ä½¿ç”¨ PriorityQueue æ¥å­˜å‚¨å…ƒç´ ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç° Delayed æ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ ã€‚åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡æ—¶æ‰èƒ½ä»é˜Ÿåˆ—ä¸­<strong>å–å‡º</strong>å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥å°† DelayQueue è¿ç”¨åœ¨ä»¥ä¸‹åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡ï¼šå¯ä»¥ç”¨ DelayQueue ä¿å­˜ç¼“å­˜å…ƒç´ çš„æœ‰æ•ˆæœŸï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¾ªç¯æŸ¥è¯¢ DelayQueueï¼Œä¸€æ—¦èƒ½ä» DelayQueue ä¸­è·å–ï¼ˆåˆ é™¤ï¼‰å…ƒç´ æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæœŸåˆ°äº†ã€‚</li>
<li>å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚ä½¿ç”¨ DelayQueue ä¿å­˜å½“å¤©å°†ä¼šæ‰§è¡Œçš„ä»»åŠ¡å’Œæ‰§è¡Œæ—¶é—´ï¼Œä¸€æ—¦ä» DelayQueue ä¸­è·å–åˆ°ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œï¼Œä»æ¯”å¦‚ TimerQueue å°±æ˜¯ä½¿ç”¨ DelayQueue å®ç°çš„ã€‚</li>
</ul>
<p>é˜Ÿåˆ—ä¸­çš„ Delayed å¿…é¡»å®ç° compareTo æ¥æŒ‡å®šå…ƒç´ çš„é¡ºåºã€‚æ¯”å¦‚è®©å»¶æ—¶æ—¶é—´æœ€é•¿çš„æ”¾åœ¨é˜Ÿåˆ—çš„æœ«å°¾ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<p><strong>å¦‚ä½•å®ç° Delayed æ¥å£</strong></p>
<p>æˆ‘ä»¬å¯ä»¥å‚è€ƒ ScheduledThreadPoolExecutor é‡Œ ScheduledFutureTask ç±»ã€‚è¿™ä¸ªç±»å®ç°äº† Delayed æ¥å£ã€‚</p>
<p>ç„¶åä½¿ç”¨ getDelay å¯ä»¥æŸ¥è¯¢å½“å‰å…ƒç´ è¿˜éœ€è¦å»¶æ—¶å¤šä¹…ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getDelay</span><span class="params">(TimeUnit unit)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> unit.convert(time - now(), TimeUnit.NANOSECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ„é€ å‡½æ•°å¯ä»¥çœ‹å‡ºå»¶è¿Ÿæ—¶é—´å‚æ•° ns çš„å•ä½æ˜¯çº³ç§’ï¼Œè‡ªå·±è®¾è®¡çš„æ—¶å€™æœ€å¥½ä½¿ç”¨çº³ç§’ï¼Œå› ä¸º getDelay æ—¶å¯ä»¥æŒ‡å®šä»»æ„å•ä½ï¼Œä¸€æ—¦ä»¥çº³ç§’ä½œä¸ºå•ä½ï¼Œè€Œå»¶æ—¶çš„æ—¶é—´åˆç²¾ç¡®ä¸åˆ°çº³ç§’å°±éº»çƒ¦äº†ã€‚ä½¿ç”¨æ—¶è¯·æ³¨æ„å½“ time å°äºå½“å‰æ—¶é—´æ—¶ï¼ŒgetDelay ä¼šè¿”å›è´Ÿæ•°ã€‚</p>
<p><strong>å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—</strong></p>
<p>å»¶æ—¶é˜Ÿåˆ—çš„å®ç°å¾ˆç®€å•ï¼Œå½“æ¶ˆè´¹è€…ä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ æ—¶ï¼Œå¦‚æœå…ƒç´ æ²¡æœ‰è¾¾åˆ°å»¶æ—¶æ—¶é—´ï¼Œå°±é˜»å¡å½“å‰çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Delayed;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedEle</span> <span class="keyword">implements</span> <span class="title class_">Delayed</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> delayTime; <span class="comment">//å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> expire;  <span class="comment">//åˆ°æœŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String data;   <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DelayedEle</span><span class="params">(<span class="type">long</span> delay, String data)</span> &#123;</span><br><span class="line">        delayTime = delay;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        expire = System.currentTimeMillis() + delay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰©ä½™æ—¶é—´=åˆ°æœŸæ—¶é—´-å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getDelay</span><span class="params">(TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unit.convert(<span class="built_in">this</span>.expire - System.currentTimeMillis() , TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜å…ˆé˜Ÿåˆ—é‡Œé¢ä¼˜å…ˆçº§è§„åˆ™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Delayed o)</span> &#123;</span><br><span class="line">        <span class="comment">//æ ¹æ® delay æ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) (<span class="built_in">this</span>.getDelay(TimeUnit.MILLISECONDS) -o.getDelay(TimeUnit.MILLISECONDS));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;DelayedElement&#123;&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;delay=&quot;</span>).append(delayTime);</span><br><span class="line">        sb.append(<span class="string">&quot;, expire=&quot;</span>).append(expire);</span><br><span class="line">        sb.append(<span class="string">&quot;, data=&#x27;&quot;</span>).append(data).append(<span class="string">&#x27;\&#x27;&#x27;</span>);</span><br><span class="line">        sb.append(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.DelayQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/8/7 17:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        DelayQueue&lt;DelayedEle&gt; delayQueue = <span class="keyword">new</span> <span class="title class_">DelayQueue</span>&lt;DelayedEle&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">DelayedEle</span> <span class="variable">element1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DelayedEle</span>(<span class="number">3000</span>,<span class="string">&quot;lgw&quot;</span>);</span><br><span class="line">        <span class="type">DelayedEle</span> <span class="variable">element2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DelayedEle</span>(<span class="number">3000</span>,<span class="string">&quot;top&quot;</span>);</span><br><span class="line"></span><br><span class="line">        delayQueue.offer(element1);</span><br><span class="line">        delayQueue.offer(element2);</span><br><span class="line">        <span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(l);</span><br><span class="line">        element1 =  delayQueue.take();</span><br><span class="line">        System.out.println(System.currentTimeMillis()-l);</span><br><span class="line"></span><br><span class="line">        System.out.println(element1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æµ‹è¯•ç»“æœ</span></span><br><span class="line"><span class="comment"> *  1565176036796</span></span><br><span class="line"><span class="comment"> *  3016</span></span><br><span class="line"><span class="comment"> *  DelayedElement&#123;delay=3000, expire=1565176039796, data=&#x27;lgw&#x27;&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="SynchronousQueue"><a href="#SynchronousQueue" class="headerlink" title="SynchronousQueue"></a>SynchronousQueue</h3><p>SynchronousQueue æ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸€ä¸ª put æ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ª take æ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚SynchronousQueue å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªä¼ çƒæ‰‹ï¼Œè´Ÿè´£æŠŠç”Ÿäº§è€…çº¿ç¨‹å¤„ç†çš„æ•°æ®ç›´æ¥ä¼ é€’ç»™æ¶ˆè´¹è€…çº¿ç¨‹ã€‚é˜Ÿåˆ—æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œéå¸¸é€‚åˆäºä¼ é€’æ€§åœºæ™¯ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®ï¼Œä¼ é€’ç»™å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼ŒSynchronousQueue çš„ååé‡é«˜äº LinkedBlockingQueue å’Œ ArrayBlockingQueueã€‚</p>
<blockquote>
<p>çº¿ç¨‹æ± å·¥å‚æ–¹æ³• <strong>newCachedThreadPool</strong> åº•å±‚å°±æ˜¯ç”¨çš„ Synchronized</p>
</blockquote>
<h3 id="LinkedTransferQueue"><a href="#LinkedTransferQueue" class="headerlink" title="LinkedTransferQueue"></a>LinkedTransferQueue</h3><p>TransferQueue ç›¸æ¯” SynchronousQueue ç”¨å¤„æ›´å¹¿ã€æ›´å¥½ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥å†³å®šæ˜¯ä½¿ç”¨ BlockingQueue çš„æ–¹æ³•ï¼ˆè¯‘è€…æ³¨ï¼šä¾‹å¦‚ put æ–¹æ³•ï¼‰è¿˜æ˜¯ç¡®ä¿ä¸€æ¬¡ä¼ é€’å®Œæˆï¼ˆè¯‘è€…æ³¨ï¼šå³ transfer æ–¹æ³•ï¼‰ã€‚åœ¨é˜Ÿåˆ—ä¸­å·²æœ‰å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨ transfer æ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿é˜Ÿåˆ—ä¸­è¢«ä¼ é€’å…ƒç´ ä¹‹å‰çš„æ‰€æœ‰å…ƒç´ éƒ½èƒ½è¢«å¤„ç†ã€‚<a target="_blank" rel="noopener" href="http://cs.oswego.edu/pipermail/concurrency-interest/2009-February/005888.html">Doug Lea è¯´</a> ä»åŠŸèƒ½è§’åº¦æ¥è®²ï¼ŒLinkedTransferQueue å®é™…ä¸Šæ˜¯ ConcurrentLinkedQueueã€SynchronousQueueï¼ˆå…¬å¹³æ¨¡å¼ï¼‰å’Œ LinkedBlockingQueue çš„è¶…é›†ã€‚è€Œä¸” LinkedTransferQueue æ›´å¥½ç”¨ï¼Œå› ä¸ºå®ƒä¸ä»…ä»…ç»¼åˆäº†è¿™å‡ ä¸ªç±»çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ›´é«˜æ•ˆçš„å®ç°ã€‚</p>
<p>LinkedTransferQueue æ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡ TransferQueue é˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜»å¡é˜Ÿåˆ— LinkedTransferQueue å¤šäº† tryTransfer å’Œ transfer æ–¹æ³•ã€‚</p>
<p>LinkedTransferQueue ä¸ SynchronousQueue ä¸­å…¬å¹³æ¨¡å¼çš„å®ç° TransferQueue æ˜¯ä¸€æ ·çš„ï¼Œé˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä¸æ˜¯æ•°æ®ï¼Œè€Œæ˜¯æ“ä½œï¼ˆå–å‡ºæ•°æ®çš„æ“ä½œ take å’Œæ”¾å…¥æ•°æ®çš„æ“ä½œ putï¼‰é˜Ÿåˆ—ä¸­æ—¢å¯ä»¥å­˜æ”¾ take æ“ä½œä¹Ÿå¯ä»¥å­˜æ”¾ put æ“ä½œï¼Œä½†æ˜¯é˜Ÿåˆ—ä¸­ä¸èƒ½åŒæ—¶å­˜åœ¨ä¸¤ç§ä¸åŒçš„æ“ä½œï¼Œå› ä¸ºä¸åŒçš„æ“ä½œä¼šè§¦å‘é˜Ÿåˆ—è¿›è¡Œé…å¯¹ï¼ˆæ“ä½œå‡ºé˜Ÿï¼‰ã€‚</p>
<p><strong>transfer æ–¹æ³•</strong>ã€‚å¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…æ­£åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼ˆæ¶ˆè´¹è€…ä½¿ç”¨ take() æ–¹æ³•æˆ–å¸¦æ—¶é—´é™åˆ¶çš„ poll() æ–¹æ³•æ—¶ï¼‰ï¼Œtransfer æ–¹æ³•å¯ä»¥æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç«‹åˆ» transferï¼ˆä¼ è¾“ï¼‰ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œtransfer æ–¹æ³•ä¼šå°†å…ƒç´ å­˜æ”¾åœ¨é˜Ÿåˆ—çš„ tail èŠ‚ç‚¹ï¼Œå¹¶ç­‰åˆ°è¯¥å…ƒç´ è¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚transfer æ–¹æ³•çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> E <span class="title function_">xfer</span><span class="params">(E e, <span class="type">boolean</span> haveData, <span class="type">int</span> how, <span class="type">long</span> nanos)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (haveData &amp;&amp; (e == <span class="literal">null</span>))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="type">Node</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;                        <span class="comment">// the node to append, if needed</span></span><br><span class="line"></span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;                            <span class="comment">// restart on append race</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head, p = h; p != <span class="literal">null</span>;) &#123; <span class="comment">// find &amp; match first node</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isData</span> <span class="operator">=</span> p.isData;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">item</span> <span class="operator">=</span> p.item;</span><br><span class="line">            <span class="keyword">if</span> (item != p &amp;&amp; (item != <span class="literal">null</span>) == isData) &#123; <span class="comment">// unmatched</span></span><br><span class="line">                <span class="keyword">if</span> (isData == haveData)   <span class="comment">// can&#x27;t match</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> (p.casItem(item, e)) &#123; <span class="comment">// match</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">q</span> <span class="operator">=</span> p; q != h;) &#123;</span><br><span class="line">                        <span class="type">Node</span> <span class="variable">n</span> <span class="operator">=</span> q.next;  <span class="comment">// update by 2 unless singleton</span></span><br><span class="line">                        <span class="keyword">if</span> (head == h &amp;&amp; casHead(h, n == <span class="literal">null</span> ? q : n)) &#123;</span><br><span class="line">                            h.forgetNext();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;                 <span class="comment">// advance and retry</span></span><br><span class="line">                        <span class="keyword">if</span> ((h = head)   == <span class="literal">null</span> ||</span><br><span class="line">                            (q = h.next) == <span class="literal">null</span> || !q.isMatched())</span><br><span class="line">                            <span class="keyword">break</span>;        <span class="comment">// unless slack &lt; 2</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    LockSupport.unpark(p.waiter);</span><br><span class="line">                    <span class="keyword">return</span> LinkedTransferQueue.&lt;E&gt;cast(item);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">n</span> <span class="operator">=</span> p.next;</span><br><span class="line">            p = (p != n) ? n : (h = head); <span class="comment">// Use head if p offlist</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (how != NOW) &#123;                 <span class="comment">// No matches available</span></span><br><span class="line">            <span class="keyword">if</span> (s == <span class="literal">null</span>)</span><br><span class="line">                s = <span class="keyword">new</span> <span class="title class_">Node</span>(e, haveData);</span><br><span class="line">            <span class="comment">//ï¼ˆ1ï¼‰å°è¯•æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">pred</span> <span class="operator">=</span> tryAppend(s, haveData);</span><br><span class="line">            <span class="keyword">if</span> (pred == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">continue</span> retry;           <span class="comment">// lost race vs opposite mode</span></span><br><span class="line">            <span class="keyword">if</span> (how != ASYNC)</span><br><span class="line">            <span class="comment">//ï¼ˆ2ï¼‰ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line">                <span class="keyword">return</span> awaitMatch(s, pred, e, (how == TIMED), nanos);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e; <span class="comment">// not waiting</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ1ï¼‰ä»£ç æ˜¯è¯•å›¾æŠŠå­˜æ”¾å½“å‰å…ƒç´ çš„ s èŠ‚ç‚¹ä½œä¸º tail èŠ‚ç‚¹ã€‚ï¼ˆ2ï¼‰ä»£ç æ˜¯è®© CPU è‡ªæ—‹ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹å…ƒç´ ã€‚å› ä¸ºè‡ªæ—‹ä¼šæ¶ˆè€— CPUï¼Œæ‰€ä»¥è‡ªæ—‹ä¸€å®šçš„æ¬¡æ•°åä½¿ç”¨ Thread.yield() æ–¹æ³•æ¥æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚</p>
<p><strong>tryTransfer æ–¹æ³•</strong>ã€‚åˆ™æ˜¯ç”¨æ¥è¯•æ¢ä¸‹ç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ æ˜¯å¦èƒ½ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œåˆ™è¿”å› falseã€‚å’Œ transfer æ–¹æ³•çš„åŒºåˆ«æ˜¯ tryTransfer æ–¹æ³•æ— è®ºæ¶ˆè´¹è€…æ˜¯å¦æ¥æ”¶ï¼Œæ–¹æ³•ç«‹å³è¿”å›ã€‚è€Œ transfer æ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚</p>
<p>å¯¹äºå¸¦æœ‰æ—¶é—´é™åˆ¶çš„ tryTransfer(E e, long timeout, TimeUnit unit) æ–¹æ³•ï¼Œåˆ™æ˜¯è¯•å›¾æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥å…ƒç´ åˆ™ç­‰å¾…æŒ‡å®šçš„æ—¶é—´å†è¿”å›ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æ¶ˆè´¹å…ƒç´ ï¼Œåˆ™è¿”å› falseï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ¶ˆè´¹äº†å…ƒç´ ï¼Œåˆ™è¿”å› trueã€‚</p>
<p><strong>å®ä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> juc_study.collection.blocking;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedTransferQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedTransferQueueDemo</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> LinkedTransferQueue&lt;String&gt; lnkTransQueue = <span class="keyword">new</span> <span class="title class_">LinkedTransferQueue</span>&lt;String&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">exService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedTransferQueueDemo</span>().<span class="keyword">new</span> <span class="title class_">Producer</span>();</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedTransferQueueDemo</span>().<span class="keyword">new</span> <span class="title class_">Consumer</span>();</span><br><span class="line">        exService.execute(producer);</span><br><span class="line">        exService.execute(consumer);</span><br><span class="line">        exService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Producer is waiting to transfer...&quot;</span>);</span><br><span class="line">                    lnkTransQueue.transfer(<span class="string">&quot;A&quot;</span>+i);</span><br><span class="line">                    System.out.println(<span class="string">&quot;producer transfered element: A&quot;</span>+i);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Consumer is waiting to take element...&quot;</span>);</span><br><span class="line">                    String s= lnkTransQueue.take();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Consumer received Element: &quot;</span>+s);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LinkedBlockingDeque"><a href="#LinkedBlockingDeque" class="headerlink" title="LinkedBlockingDeque"></a>LinkedBlockingDeque</h3><p>LinkedBlockingDeque æ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚æ‰€è°“åŒå‘é˜Ÿåˆ—æŒ‡çš„ä½ å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œç§»å‡ºå…ƒç´ ã€‚åŒç«¯é˜Ÿåˆ—å› ä¸ºå¤šäº†ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—çš„å…¥å£ï¼Œåœ¨å¤šçº¿ç¨‹åŒæ—¶å…¥é˜Ÿæ—¶ï¼Œä¹Ÿå°±å‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚ç›¸æ¯”å…¶ä»–çš„é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedBlockingDeque å¤šäº† addFirstï¼ŒaddLastï¼ŒofferFirstï¼ŒofferLastï¼ŒpeekFirstï¼ŒpeekLast ç­‰æ–¹æ³•ï¼Œä»¥ First å•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–ï¼ˆpeekï¼‰æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä»¥ Last å•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚å¦å¤–æ’å…¥æ–¹æ³• add ç­‰åŒäº addLastï¼Œç§»é™¤æ–¹æ³• remove ç­‰æ•ˆäº removeFirstã€‚ä½†æ˜¯ take æ–¹æ³•å´ç­‰åŒäº takeFirstï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ Jdk çš„ bugï¼Œä½¿ç”¨æ—¶è¿˜æ˜¯ç”¨å¸¦æœ‰ First å’Œ Last åç¼€çš„æ–¹æ³•æ›´æ¸…æ¥šã€‚åœ¨åˆå§‹åŒ– LinkedBlockingDeque æ—¶å¯ä»¥åˆå§‹åŒ–é˜Ÿåˆ—çš„å®¹é‡ï¼Œç”¨æ¥é˜²æ­¢å…¶å†æ‰©å®¹æ—¶è¿‡æ¸¡è†¨èƒ€ã€‚å¦å¤–åŒå‘é˜»å¡é˜Ÿåˆ—å¯ä»¥è¿ç”¨åœ¨â€œå·¥ä½œçªƒå–â€æ¨¡å¼ä¸­ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://my.oschina.net/bzhangpoorman/blog/3044802">å¹¶å‘å®¹å™¨å­¦ä¹ â€”LinkedTransferQueue</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/YJian2008/article/details/16951811">é˜»å¡é˜Ÿåˆ—ä¹‹ LinkedTransferQueue</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2659eb72134b">å¹¶å‘é˜Ÿåˆ—-æ— ç•Œé˜»å¡å»¶è¿Ÿé˜Ÿåˆ— DelayQueue åŸç†æ¢ç©¶</a></p>
<p><a target="_blank" rel="noopener" href="http://ifeve.com/blocking-queues/">å¹¶å‘ç¼–ç¨‹ç½‘</a></p>
<p><a target="_blank" rel="noopener" href="http://ifeve.com/java-transfer-queue/">Java 7 ä¸­çš„ TransferQueue</a></p>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">èµèµ</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="">
        <p> æ„Ÿè°¢é¼“åŠ± </p>
    </div>
</div>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/imlgw">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://imlgw.top">Tadow</a></span>
        <span>/</span>
        
        <span><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/publish/query/indexFirst.action">é„‚ICPå¤‡18011208å·</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json"},"display":{"superSample":2,"width":160,"height":320,"position":"right","hOffset":0,"vOffset":-70},"mobile":{"show":false,"scale":0.2},"log":false});</script></body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://giscus.app/client.js"
  data-repo="imlgw/imlgw.github.io"
  data-repo-id="MDEwOlJlcG9zaXRvcnkxMzMyMDY4NDg="
  data-category="Announcements"
  data-category-id="DIC_kwDOB_CTQM4CQ7v8"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="light"
  data-lang="zh-CN"
  data-loading="lazy"
  crossorigin="anonymous"
  async>
</script>



</html>

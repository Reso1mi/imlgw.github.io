<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="Tadow çš„åšå®¢">
    <meta property="og:type" content="website">
    <meta name="description" content="Tadow çš„åšå®¢">
    <meta name="keyword"  content="Tadow, Resolmi, imlgw, åŠå²›é“ç›’, ç®—æ³•, Java, Golang">
    <link rel="shortcut icon" href="https://fav.farm/ğŸ’­">

    <title>
        
        Socket ç½‘ç»œç¼–ç¨‹ - Tadow ç¢ç¢å¿µ
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Tadow ç¢ç¢å¿µ" type="application/atom+xml">
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Keep It Simple, Stupid </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="https://static.imlgw.top/blog/20220821160037.png" />
        </div>
        <div class="name">
            <i>Tadow</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <!-- <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>æ ‡ç­¾</span>
                </a>
            </li> -->
            <li >
                <a href="/categories">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>å­˜æ¡£</span>
                </a>
            </li>
            
            <li >
                <a href="/selfhosted">
                    <i class="iconfont icon-guidang1"></i>
                    <span>è‡ªå»º</span>
                </a>
            </li>

            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>æ”¶è—</span>
                </a>
            </li>

            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>å…³äº</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>æœç´¢</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket-%E6%A6%82%E8%BF%B0"><span class="toc-text">Socket æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP"><span class="toc-text">TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84-Socket-%E5%B0%8F%E6%A1%88%E4%BE%8B"><span class="toc-text">ç®€å•çš„ Socket å°æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP"><span class="toc-text">UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%92%AD"><span class="toc-text">å•æ’­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%92%AD-amp-%E5%B9%BF%E6%92%AD"><span class="toc-text">å¤šæ’­&amp;å¹¿æ’­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP-%E8%BE%85%E5%8A%A9-TCP-%E5%AE%9E%E7%8E%B0%E7%82%B9%E5%AF%B9%E7%82%B9%E4%BC%A0%E8%BE%93"><span class="toc-text">UDP è¾…åŠ© TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%8A%E5%A4%A9%E5%AE%A4%E5%AE%9E%E7%8E%B0"><span class="toc-text">å±€åŸŸç½‘èŠå¤©å®¤å®ç°</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">æœç´¢</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Keep It Simple, Stupid </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        Socket ç½‘ç»œç¼–ç¨‹
    </div>

    <div class="post-meta">
        <span class="attr">å‘å¸ƒäºï¼š<span>2019-07-19 00:00:00</span></span>
        
        <span class="attr">æ ‡ç­¾ï¼š/
        
        <a class="tag" href="/tags/#Socket" title="Socket">Socket</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">è®¿é—®ï¼š<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h3 id="Socket-æ¦‚è¿°"><a href="#Socket-æ¦‚è¿°" class="headerlink" title="Socket æ¦‚è¿°"></a>Socket æ¦‚è¿°</h3><p>â€‹    å¥—æ¥å­—ï¼ˆsocketï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œå¯å¯¹å…¶è¿›è¡Œåƒå¯¹æ–‡ä»¶ä¸€æ ·çš„æ‰“å¼€ã€è¯»å†™å’Œå…³é—­ç­‰æ“ä½œã€‚å¥—æ¥å­—å…è®¸åº”ç”¨ç¨‹åºå°† I/O æ’å…¥åˆ°ç½‘ç»œä¸­ï¼Œå¹¶ä¸ç½‘ç»œä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ç½‘ç»œå¥—æ¥å­—æ˜¯ IP åœ°å€ä¸ç«¯å£çš„ç»„åˆã€‚socket æä¾›çš„å‡½æ•°æ˜¯<strong>æ“ä½œç³»ç»Ÿå†…æ ¸å°†â€œTCP/IP åè®®æ ˆ + åº•å±‚ç½‘å¡â€æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªä¸ªç”¨æˆ·å‹å¥½çš„å‡½æ•°ï¼Œç”¨äºæ“çºµæœ¬åœ°çš„â€œTCP/IP åè®®æ ˆ + åº•å±‚ç½‘å¡â€ä¸è¿œç«¯çš„æœåŠ¡å™¨/ä¸»æœºå®Œæˆé€šä¿¡çš„ä»»åŠ¡ã€‚</strong></p>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p>ğŸ”¸ TCP æ˜¯é¢å‘è¿æ¥çš„é€šä¿¡åè®®</p>
<p>ğŸ”¸ é€šè¿‡<code>ä¸‰æ¬¡æ¡æ‰‹</code>å»ºç«‹è¿æ¥ï¼Œé€šè®¯å®Œæˆæ—¶è¦æ‹†é™¤è¿æ¥</p>
<p>ğŸ”¸ ç”±äº TCP æ˜¯é¢å‘è¿æ¥çš„æ‰€ä»¥åªèƒ½ç”¨äºç«¯åˆ°ç«¯çš„é€šè®¯</p>
<p>ğŸ”¸ ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</p>
<p>ğŸ”¸ å…·æœ‰æ ¡éªŒæœºåˆ¶ï¼Œå¯é ï¼Œæ•°æ®ä¼ è¾“ç¨³å®š</p>
<h4 id="ç®€å•çš„-Socket-å°æ¡ˆä¾‹"><a href="#ç®€å•çš„-Socket-å°æ¡ˆä¾‹" class="headerlink" title="ç®€å•çš„ Socket å°æ¡ˆä¾‹"></a>ç®€å•çš„ Socket å°æ¡ˆä¾‹</h4><p><strong>Socket å®¢æˆ·ç«¯</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TcpDemo;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 9:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REMOTE_PORT</span> <span class="operator">=</span> <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">LOCAL_PORT</span> <span class="operator">=</span> <span class="number">30000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> creatSocket();</span><br><span class="line">        initSocket(socket);</span><br><span class="line">        <span class="comment">//setRecessAddress å‰</span></span><br><span class="line">        socket.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(InetAddress.getLocalHost(), LOCAL_PORT));</span><br><span class="line">        <span class="comment">//è¿æ¥è¿œç¨‹ server</span></span><br><span class="line">        socket.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(InetAddress.getLocalHost(), REMOTE_PORT), <span class="number">3000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å·²ç»å‘èµ·è¿æ¥&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯ä¿¡æ¯ï¼š&quot;</span> + socket.getLocalAddress() + <span class="string">&quot;port:&quot;</span> + socket.getLocalPort());</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡ç«¯ä¿¡æ¯&quot;</span> + socket.getInetAddress() + <span class="string">&quot;port:&quot;</span> + socket.getPort());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sendMsg(socket);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;è¿æ¥å¼‚å¸¸å…³é—­ï¼ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initSocket</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> SocketException &#123;</span><br><span class="line">        socket.setSoTimeout(<span class="number">3000</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å¤ç”¨æœªå®Œå…¨å…³é—­åçš„ç«¯å£ (TIME_WAIT çŠ¶æ€ï¼‰ï¼Œå¿…é¡»åœ¨ bind å‰ï¼Œæ‰€ä»¥å°±ä¸èƒ½é€šè¿‡æ„é€ å™¨æ¥ç»‘å®šæœ¬åœ°ç«¯å£</span></span><br><span class="line">        socket.setReuseAddress(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å¼€å¯ Nagle ç®—æ³•ï¼ˆé»˜è®¤å¼€å¯ï¼‰ https://baike.baidu.com/item/Nagle%E7%AE%97%E6%B3%95</span></span><br><span class="line">        socket.setTcpNoDelay(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//é•¿æ—¶é—´æ— æ•°æ®ç›¸åº”çš„æ—¶å€™å‘é€ç¡®è®¤æ•°æ®ï¼ˆå¿ƒè·³åŒ…ï¼‰æ—¶é—´å¤§çº¦ä¸¤ä¸ªå°æ—¶</span></span><br><span class="line">        socket.setKeepAlive(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          close å…³é—­åçš„å¤„ç†</span></span><br><span class="line"><span class="comment">          è¿™ä¸ª Socket é€‰é¡¹å¯ä»¥å½±å“ close æ–¹æ³•çš„è¡Œä¸ºã€‚</span></span><br><span class="line"><span class="comment">          false 0 é»˜è®¤æƒ…å†µ å…³é—­åç«‹å³è¿”å›ï¼Œåº•å±‚ç³»ç»Ÿæ¥ç®¡è¾“å‡ºæµï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å‘é€å®Œæˆ</span></span><br><span class="line"><span class="comment">          true 0 å…³é—­åç›´æ¥è¿”å› ç¼“å†²åŒºæ•°æ®ç›´æ¥æŠ›å¼ƒ ç›´æ¥å‘é€ RES ç»“æŸå‘½ä»¤åˆ°å¯¹æ–¹ï¼Œæ— éœ€ç»è¿‡ 2MSL ç­‰å¾…</span></span><br><span class="line"><span class="comment">          true 200 å…³é—­æ—¶æœ€é•¿é˜»å¡ 200s éšåæŒ‰ç¬¬äºŒæƒ…å†µå¤„ç†</span></span><br><span class="line"><span class="comment">          ï¼ˆæ˜¯ s ä¸æ˜¯ ms, å¼€å§‹æé”™äº† è®¾ç½®äº† 20 é‡å¯å°±ä¼šç«¯å£å ç”¨ã€‚)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        socket.setSoLinger(<span class="literal">true</span>, <span class="number">0</span>);</span><br><span class="line">       </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è®¾ç½®ç´§æ€¥æ•°æ®æ˜¯å¦å†…æ•›ï¼Œå¦‚æœè¿™ä¸ª Socket é€‰é¡¹æ‰“å¼€ï¼Œ</span></span><br><span class="line"><span class="comment">        å¯ä»¥é€šè¿‡ Socket ç±»çš„ sendUrgentData æ–¹æ³•</span></span><br><span class="line"><span class="comment">        å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå•å­—èŠ‚çš„æ•°æ® è¿™ä¸ªå•å­—èŠ‚æ•°æ®å¹¶ä¸ç»è¿‡è¾“å‡ºç¼“å†²åŒºï¼Œè€Œæ˜¯ç«‹å³å‘å‡ºã€‚</span></span><br><span class="line"><span class="comment">        è™½ç„¶åœ¨å®¢æˆ·ç«¯å¹¶ä¸æ˜¯ä½¿ç”¨ OutputStream å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œ</span></span><br><span class="line"><span class="comment">        ä½†åœ¨æœåŠ¡ç«¯ç¨‹åºä¸­è¿™ä¸ªå•å­—èŠ‚çš„æ•°æ®æ˜¯å’Œå…¶å®ƒçš„æ™®é€šæ•°æ®æ··åœ¨ä¸€èµ·çš„</span></span><br><span class="line"><span class="comment">        å› æ­¤ï¼Œåœ¨æœåŠ¡ç«¯ç¨‹åºä¸­å¹¶ä¸çŸ¥é“ç”±å®¢æˆ·</span></span><br><span class="line"><span class="comment">        ç«¯å‘è¿‡æ¥çš„æ•°æ®æ˜¯ç”± OutputStream</span></span><br><span class="line"><span class="comment">        è¿˜æ˜¯ç”± sendUrgentData å‘è¿‡æ¥çš„</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        socket.setOOBInline(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ”¶å‘ç¼“å†²å™¨å¤§å°ï¼Œé»˜è®¤ 32K</span></span><br><span class="line">        socket.setReceiveBufferSize(<span class="number">64</span>*<span class="number">1024</span>);</span><br><span class="line">        socket.setSendBufferSize(<span class="number">64</span>*<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ€§èƒ½å‚æ•°çš„ ä¼˜å…ˆçº§  çŸ­é“¾æ¥ å»¶è¿Ÿ å¸¦å®½</span></span><br><span class="line">        socket.setPerformancePreferences(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Socket <span class="title function_">creatSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //æ— ä»£ç†æ¨¡å¼ï¼Œç›¸å½“äºç©ºæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">        Socket socket = new Socket(Proxy.NO_PROXY);</span></span><br><span class="line"><span class="comment">        //HTTP ä»£ç†æ¨¡å¼ä¼ è¾“çš„æ•°æ®å°†é€šè¿‡ www.imlgw.top è½¬å‘</span></span><br><span class="line"><span class="comment">        socket = new Socket(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(Inet4Address.getByName(&quot;www.imlgw.top&quot;), 80)));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        //ä¸‹é¢ä¸¤ç§æ–¹å¼å›åœ¨åˆ›å»ºçš„æ—¶å€™å°±å»é“¾æ¥è¿œç¨‹çš„æœåŠ¡å™¨ï¼ˆå…·ä½“çœ‹æºç ï¼‰, ç„¶è€Œä¸€èˆ¬æƒ…å†µä¸‹å…¶å®åœ¨è¿æ¥ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€äº›å‚æ•°</span></span><br><span class="line"><span class="comment">        //æ–°å»ºä¸€ä¸ªå¥—æ¥å­— é“¾æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å’Œç«¯å£ï¼ˆæœ¬åœ°ç«¯å£ä¸ºç³»ç»Ÿåˆ†é…ï¼‰</span></span><br><span class="line"><span class="comment">        socket = new Socket(&quot;imlgw.top&quot;, REMOTE_PORT);</span></span><br><span class="line"><span class="comment">        //æ–°å»ºå¥—æ¥å­—ç›´æ¥é“¾æ¥åˆ°è¿œç¨‹ç«¯å£ å¹¶ç»‘å®šæœ¬åœ°ç«¯å£</span></span><br><span class="line"><span class="comment">        socket=new Socket(&quot;imlgw.top&quot;,REMOTE_PORT,InetAddress.getLocalHost(),LOCAL_PORT);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–°å»º socket ç„¶åç»‘å®šåˆ°æœ¬åœ°ç«¯å£</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>();</span><br><span class="line">        <span class="keyword">return</span> socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//é”®ç›˜çš„è¾“å…¥æµ</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">//æ‹¿åˆ° socket çš„è¾“å‡ºæµ</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">socketOutputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        <span class="comment">//è½¬æ¢ä¸ºæ‰“å°æµ</span></span><br><span class="line">        <span class="type">PrintStream</span> <span class="variable">printStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(socketOutputStream);</span><br><span class="line">        <span class="comment">//socket çš„è¾“å…¥æµ</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="comment">//è½¬æ¢ä½ buffer æµ</span></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream));</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">//å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">            printStream.println(scanner.nextLine());</span><br><span class="line">            <span class="comment">//æœåŠ¡ç«¯çš„å“åº”</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;bye&quot;</span>.equals(s)) &#123;</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æœåŠ¡ç«¯å“åº”ï¼š&quot;</span> + s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (flag);</span><br><span class="line">        bufferedReader.close();</span><br><span class="line">        printStream.close();</span><br><span class="line">        scanner.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Socket æœåŠ¡ç«¯</strong></p>
<p> è¿™é‡Œä¸ºäº†åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è®¾è®¡æˆäº†<strong>å¤šçº¿ç¨‹</strong>å¼‚æ­¥çš„æ¨¡å¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TcpDemo;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 9:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SERVER_PORT</span> <span class="operator">=</span> <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> creatServerSocket();</span><br><span class="line">        initServerSocket(server);</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ä¹‹åå†ç»‘å®šï¼Œä¸ç„¶ä¸€äº›è®¾ç½®ä¼šå¤±æ•ˆï¼Œæ¯”å¦‚ setReuseAddress</span></span><br><span class="line">        server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(InetAddress.getLocalHost(), SERVER_PORT), <span class="number">50</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨å‡†å¤‡å°±ç»ª&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡ç«¯ä¿¡æ¯&quot;</span> + server.getInetAddress() + <span class="string">&quot; port:&quot;</span> + server.getLocalPort());</span><br><span class="line">        <span class="comment">//ç›‘å¬å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">//é˜»å¡æ–¹æ³•</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">            <span class="type">ClientHandle</span> <span class="variable">clientHandle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientHandle</span>(client);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(clientHandle).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initServerSocket</span><span class="params">(ServerSocket server)</span> <span class="keyword">throws</span> SocketException &#123;</span><br><span class="line">        <span class="comment">//åŒ client</span></span><br><span class="line">        server.setReuseAddress(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½® accept çš„ buffer</span></span><br><span class="line">        server.setReceiveBufferSize(<span class="number">64</span> * <span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½® timeout</span></span><br><span class="line">        <span class="comment">//server.setSoTimeout(2000);</span></span><br><span class="line">        <span class="comment">//è®¾ç½®æ€§èƒ½å‚æ•°ï¼Œè¿æ¥å‰è®¾ç½®</span></span><br><span class="line">        server.setPerformancePreferences(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ServerSocket <span class="title function_">creatServerSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>();</span><br><span class="line">        <span class="comment">//ç»‘å®šç«¯å£ backlog: æ–°è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶ï¼Œä¸æ˜¯é“¾æ¥çš„æ•°é‡ï¼Œæ˜¯å…è®¸ç­‰å¾…çš„é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">        <span class="comment">//server.bind(new InetSocketAddress(InetAddress.getLocalHost(),SERVER_PORT),50);</span></span><br><span class="line">        <span class="comment">//server =new ServerSocket(SERVER_PORT,50); ç­‰æ•ˆæ–¹æ¡ˆ</span></span><br><span class="line">        <span class="comment">//server =new ServerSocket(SERVER_PORT,50,InetAddress.getLocalHost());</span></span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ClientHandle</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">        ClientHandle(Socket client) &#123;</span><br><span class="line">            <span class="built_in">this</span>.socket = client;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š&quot;</span> + socket.getInetAddress() + <span class="string">&quot;portï¼š&quot;</span> + socket.getPort());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//è¾“å…¥æµè·å–ä¿¡æ¯</span></span><br><span class="line">                <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(socket.getInputStream()));</span><br><span class="line">                <span class="comment">//è¾“å‡ºæµå“åº”å®¢æˆ·ç«¯</span></span><br><span class="line">                <span class="type">PrintStream</span> <span class="variable">printStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(socket.getOutputStream());</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;bye&quot;</span>.equalsIgnoreCase(s)) &#123;</span><br><span class="line">                        flag = <span class="literal">false</span>;</span><br><span class="line">                        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å…³é—­äº†è¿æ¥&quot;</span>);</span><br><span class="line">                        printStream.println(<span class="string">&quot;bye&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(s);</span><br><span class="line">                        printStream.println(<span class="string">&quot;å­—ç¬¦ä¸²é•¿åº¦#&quot;</span> + s.length());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">while</span> (flag);</span><br><span class="line">                reader.close();</span><br><span class="line">                printStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…·ä½“çš„ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•è§£é‡Šéƒ½åœ¨ä»£ç çš„æ³¨é‡Šä¸­ <a target="_blank" rel="noopener" href="https://elf8848.iteye.com/blog/1739598">å‚è€ƒ</a></p>
</blockquote>
<p><img src="http://static.imlgw.top/image/20190707/eBKfzShaiIHU.png?imageslim" alt="mark"></p>
<h4 id="ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹"><a href="#ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹"></a>ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹</h4><p>ä¸Šé¢çš„å“ªä¸ªå°æ¡ˆä¾‹ä¼ é€çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿè®¸æœ‰åŒå­¦ä¼šè¯´è¿™äº›åŸºæœ¬ç±»å‹ä¸éƒ½æ˜¯å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥ä¼ å—ï¼Ÿä¸ºä»€ä¹ˆè¦è´¹é‚£ä¸ªåŠ²å»ä¼ è¿™äº›åŸºæœ¬ç±»å‹ï¼Ÿå…¶å®ä¸ç„¶ï¼Œè¿™é‡Œå‡è®¾è¦ä¼ é€çš„æ˜¯ int ç±»å‹çš„ 12345678 ï¼Œå¦‚æœé€šè¿‡ <code>int</code> æ¥ä¼ è¾“åªè¦åœ¨èŒƒå›´å†…éƒ½æ˜¯** 4 <strong>ä¸ªå­—èŠ‚å¤§å°å›ºå®šï¼Œç„¶è€Œé€šè¿‡<code>String</code>ä¼ é€å°†ä¼šæ˜¯â€12345678â€ ä¹Ÿå°±æ˜¯</strong> 8 **ä¸ªå­—èŠ‚ï¼Œæ¶ˆè€—è¦æ¯”ä½¿ç”¨<code>int</code>è¦å¤§ï¼Œè€Œä¸”é•¿åº¦ä¸å›ºå®šï¼Œä¸æ–¹ä¾¿åæœŸæ¥å—çš„é•¿åº¦åˆ¤æ–­ã€‚</p>
<p> <strong><code>int</code> ç±»å‹</strong>  </p>
<p>åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„éƒ½æ˜¯ä»¥** Byte <strong>ä¸ºåŸºæœ¬å•ä½ï¼Œå¦‚æœè¦ä¼ é€</strong> int <strong>æˆ‘ä»¬å°±éœ€è¦å°†</strong> int <strong>è½¬æ¢ä¸º</strong> byte<strong>ï¼Œä¸€ä¸ª</strong> int <strong>æ˜¯ 4 ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª</strong> byte[] **æ•°ç»„ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/11 13:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ByteTools</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] int2byte(<span class="type">int</span> a) &#123;</span><br><span class="line">        <span class="comment">//æ— ç¬¦å·å³ç§»</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;</span><br><span class="line">                (<span class="type">byte</span>) (a &gt;&gt;&gt; <span class="number">24</span>),</span><br><span class="line">                (<span class="type">byte</span>) (a &gt;&gt;&gt; <span class="number">16</span>),</span><br><span class="line">                (<span class="type">byte</span>) (a &gt;&gt;&gt; <span class="number">8</span>),</span><br><span class="line">                (<span class="type">byte</span>) (a)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">byte2int</span><span class="params">(<span class="type">byte</span>[] a)</span> &#123;</span><br><span class="line">        <span class="comment">//&amp;0xff--&gt;è½¬æ¢ä¸º int å°†é«˜ä½è¡¥ 0, ä½ 8 ä½ä¸å˜</span></span><br><span class="line">        <span class="comment">//-127 ï¼š10000001ï¼ˆè¡¥ï¼‰ &amp;0xff --&gt; 00000000 00000000 00000000 10000001</span></span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">3</span>] &amp; <span class="number">0xff</span> | (a[<span class="number">2</span>] &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">8</span> | (a[<span class="number">1</span>] &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">16</span> | (a[<span class="number">0</span>] &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆè¿™æ ·åšçš„ä¸€äº›ç»†èŠ‚å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.cnblogs.com/think-in-java/p/5527389.html">è¿™ç¯‡åšå®¢</a></p>
<p>æœ‰äº†è¿™ä¸ªå·¥å…·ç±»æˆ‘ä»¬å°±å¯ä»¥å°†** int <strong>è½¬æ¢ä¸º</strong> byte[] **åè¿›è¡Œä¼ è¾“ï¼ŒåŒæ—¶æ¥æ”¶ç«¯ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•å°†æ•°æ®è¿˜åŸã€‚</p>
<p>ç­‰ç­‰ğŸ™„ ï¼Œè¿™æ ·ä¸€æ¥ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹å¯¹åº”çš„éƒ½è¦å»å†™ä¸ªè¿™æ ·çš„è½¬æ¢çš„æ–¹æ³•ï¼Ÿé‚£è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œæ‰€ä»¥è¿™æ ·çš„äº‹æƒ…** JDK **å¸®æˆ‘ä»¬åšäº†</p>
<p><strong><code>ByteBuffer</code>**ï¼šnio ä¸­çš„ä¸€ä¸ªåŒ…ï¼Œè¿™é‡Œæˆ‘è¿˜ä¸å¤ªç†Ÿæ‚‰è¿™ä¸ªå…·ä½“çš„ä½œç”¨ï¼Œç›®å‰åªçŸ¥é“å¯ä»¥ç”¨æ¥åŒ…è£…</strong> byte[]**ï¼Œç„¶åå¯ä»¥å®ç°ä¸Šé¢çš„ç±»å‹è½¬æ¢</p>
<p><strong>Client å‘é€ç«¯</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">byte</span>[] buffer=<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];</span><br><span class="line"><span class="comment">//åŒ…è£… buffer ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼Ÿ</span></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.wrap(buffer);</span><br><span class="line"><span class="comment">//byte  1</span></span><br><span class="line">byteBuffer.put((<span class="type">byte</span>) <span class="number">126</span>);</span><br><span class="line"><span class="comment">//int ç±»å‹ 4</span></span><br><span class="line">byteBuffer.putInt(<span class="number">123</span>);</span><br><span class="line"><span class="comment">//char 2(unicode)</span></span><br><span class="line">byteBuffer.putChar(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="comment">//long 8</span></span><br><span class="line">byteBuffer.putLong(<span class="number">323333231234124321L</span>);</span><br><span class="line"><span class="type">boolean</span> isOk=<span class="literal">true</span>;</span><br><span class="line"><span class="comment">//byte 1</span></span><br><span class="line">byteBuffer.put((<span class="type">byte</span>) (isOk?<span class="number">1</span>:<span class="number">0</span>));</span><br><span class="line"><span class="comment">//float 4</span></span><br><span class="line">byteBuffer.putFloat(<span class="number">123.2132F</span>);</span><br><span class="line"><span class="comment">//double 8 =28</span></span><br><span class="line">byteBuffer.putDouble(<span class="number">231.1412421321</span>);</span><br><span class="line"><span class="comment">//String 10</span></span><br><span class="line">byteBuffer.put(<span class="string">&quot;HelloWorld&quot;</span>.getBytes());</span><br><span class="line"><span class="comment">//å‘é€ 38 Byte </span></span><br><span class="line">socketOutputStream.write(buffer,<span class="number">0</span>,byteBuffer.position());</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯æœ€å** write <strong>çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªå‚æ•°</strong> len<strong>ï¼Œç›´æ¥ä¼ </strong> position()**, å°±å¯ä»¥äº†ï¼Œä¸ç”¨+1ï¼Œè¿™ä¸ª position æ˜¯ä¸‹ä¸€ä¸ªå­—èŠ‚ä½ç½®</p>
<blockquote>
<p>è¿™é‡Œå…¶å®æˆ‘çœ‹çš„æ•™ç¨‹è¿™é‡Œæ˜¯åŠ  1 äº†çš„ï¼Œæœ€åæ¥æ”¶è¿‡æ¥çš„æ•°æ®é•¿åº¦æ­»æ´»å¯¹ä¸ä¸Šï¼Œæˆ‘å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä»€ä¹ˆ<strong>å†…å­˜å¯¹é½</strong>ï¼Œä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„ç„¶åæ‰å‘ç°æ˜¯è¿™é‡Œæœ‰é—®é¢˜ã€‚</p>
</blockquote>
<p><strong>Server æ¥æ”¶ç«¯</strong></p>
<p>åŸºæœ¬ç±»å‹çš„è¯»å–ä¸ä¸Šé¢å¯¹åº”çš„** get<strong>ï¼Œæœ€åä¸€ä¸ª String éœ€è¦æ³¨æ„ï¼Œç›´æ¥ç”¨åŸå§‹çš„</strong> buffer <strong>å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å€ŸåŠ©</strong> ByteBuffer**ï¼Œè¿™é‡ŒåŒæ ·åé¢ä¸ç”¨-1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer, byteBuffer.position(), readByteCount-byteBuffer.position());</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æœåŠ¡å™¨å‡†å¤‡å°±ç»ª</span><br><span class="line">æœåŠ¡ç«¯ä¿¡æ¯ LAPTOP-V5R5ABUJ/<span class="number">192.168</span><span class="number">.25</span><span class="number">.1</span> port:<span class="number">20000</span></span><br><span class="line">æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š/<span class="number">192.168</span><span class="number">.25</span>.1portï¼š<span class="number">30000</span></span><br><span class="line">å½“å‰ä¸‹æ ‡ <span class="number">28</span></span><br><span class="line">æ¥å—åˆ° Client æ•°æ®é•¿åº¦ (<span class="type">byte</span>)ï¼š<span class="number">38</span></span><br><span class="line">Client å‘é€çš„æ•°æ®ï¼š</span><br><span class="line"><span class="number">126</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line">A</span><br><span class="line"><span class="number">323333231234124321</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="number">123.2132</span></span><br><span class="line"><span class="number">231.1412421321</span></span><br><span class="line">HelloWorld</span><br></pre></td></tr></table></figure>

<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p>ğŸ”¸  UDP æ˜¯æ— è¿æ¥çš„ï¼Œå³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚</p>
<p>ğŸ”¸  UDP ä½¿ç”¨å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨ã€‚</p>
<p>ğŸ”¸   UDP æ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„ UDP å¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜ IP å±‚ã€‚UDP å¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡ã€‚</p>
<p>ğŸ”¸   UDP æ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ã€‚å¾ˆå¤šçš„å®æ—¶åº”ç”¨ï¼ˆå¦‚ IP ç”µè¯ã€å®æ—¶è§†é¢‘ä¼šè®®ç­‰ï¼‰è¦å»æºä¸»æœºä»¥æ’å®šçš„é€Ÿç‡å‘é€æ•°æ®ï¼Œå¹¶ä¸”å…è®¸åœ¨ç½‘ç»œå‘ç”Ÿæ‹¥å¡æ—¶ä¸¢å¤±ä¸€äº›æ•°æ®ï¼Œä½†å´ä¸å…è®¸æ•°æ®æœ‰å¤ªå¤šçš„æ—¶å»¶ã€‚UDP æ­£å¥½ç¬¦åˆè¿™ç§è¦æ±‚ã€‚</p>
<p>ğŸ”¸   UDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚</p>
<p>ğŸ”¸   UDP çš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œæ¯” TCP çš„ 20 ä¸ªå­—èŠ‚çš„é¦–éƒ¨è¦çŸ­ã€‚</p>
<h4 id="å•æ’­"><a href="#å•æ’­" class="headerlink" title="å•æ’­"></a>å•æ’­</h4><p><strong>æ¶ˆæ¯æ¥æ”¶è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPProvide</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//ç›‘å¬ 20000 ç«¯å£</span></span><br><span class="line">        DatagramSocket socket=<span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">20000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;UDPProvide is start....&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] buf=<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">512</span>];</span><br><span class="line">        <span class="comment">//æ„å»ºæ¥å—çš„ DatagramPacket</span></span><br><span class="line">        DatagramPacket udp_receive=<span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf,buf.length);</span><br><span class="line">        <span class="comment">//æ„å»ºæ¥å—çš„ DatagramPacket ï¼ˆé˜»å¡ï¼‰</span></span><br><span class="line">        socket.receive(udp_receive);</span><br><span class="line">        <span class="comment">//è·å–å‘é€äººçš„ SocketAddress</span></span><br><span class="line">        <span class="type">SocketAddress</span> <span class="variable">socketAddress</span> <span class="operator">=</span> udp_receive.getSocketAddress();</span><br><span class="line">        <span class="type">int</span> <span class="variable">datalen</span> <span class="operator">=</span> udp_receive.getLength();</span><br><span class="line">        <span class="comment">//è·å–å‘é€çš„æ•°æ®</span></span><br><span class="line">        String receive=<span class="keyword">new</span> <span class="title class_">String</span>(udp_receive.getData(),<span class="number">0</span>,datalen);</span><br><span class="line">        System.out.println(<span class="string">&quot;receive from the: &quot;</span>+socketAddress);</span><br><span class="line">        System.out.println(<span class="string">&quot;receive data: &quot;</span>+ receive);</span><br><span class="line">        <span class="comment">//æ„å»ºå“åº”çš„ DatagramPacket</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = (<span class="string">&quot;provider receive the data success &quot;</span>+datalen).getBytes();</span><br><span class="line">        DatagramPacket udp_sendBack=<span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(bytes,bytes.length,socketAddress);</span><br><span class="line">        socket.send(udp_sendBack);</span><br><span class="line">        <span class="comment">//ç»“æŸ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;UDPProvide Finished.&quot;</span>);</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¶ˆæ¯å‘é€è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPSearch</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UDPSearch is ready...&quot;</span>);</span><br><span class="line">        <span class="comment">//æ„å»º socket</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();</span><br><span class="line">        <span class="type">byte</span>[] buff= <span class="string">&quot;hello world&quot;</span>.getBytes();</span><br><span class="line">        <span class="comment">//æ„å»ºå‘é€æ®µ</span></span><br><span class="line">        DatagramPacket udp_send=<span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buff,buff.length);</span><br><span class="line">        <span class="comment">//æŒ‡å®šå¯¹æ–¹ ip</span></span><br><span class="line">        udp_send.setAddress(InetAddress.getLocalHost());</span><br><span class="line">        udp_send.setPort(<span class="number">20000</span>);</span><br><span class="line">        socket.send(udp_send);</span><br><span class="line">        <span class="comment">//è·å–å“åº”æ®µ</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] buf=<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">512</span>];</span><br><span class="line">        DatagramPacket udp_receive=<span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf,buf.length);</span><br><span class="line">        socket.receive(udp_receive);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(udp_receive.getData(), <span class="number">0</span>, udp_receive.getLength());</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println(<span class="string">&quot;UDPSearch is over&quot;</span>);</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¤šæ’­-amp-å¹¿æ’­"><a href="#å¤šæ’­-amp-å¹¿æ’­" class="headerlink" title="å¤šæ’­&amp;å¹¿æ’­"></a>å¤šæ’­&amp;å¹¿æ’­</h4><p><strong>æ¶ˆæ¯å»ºé€ å™¨</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/8 8:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageCreator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SN_HEADER</span> <span class="operator">=</span> <span class="string">&quot;æ”¶åˆ°æš—å·ï¼Œæˆ‘æ˜¯ SN:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PORT_HEADER</span> <span class="operator">=</span> <span class="string">&quot;è¿™æ˜¯æš—å·ï¼Œè¯·å›é€åˆ°è¯¥ç«¯å£ï¼š&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">buildWithPort</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> PORT_HEADER + port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">parsePort</span><span class="params">(String sn)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sn.startsWith(PORT_HEADER)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(sn.substring(PORT_HEADER.length()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">buildWithSn</span><span class="params">(String sn)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SN_HEADER+sn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">parseSn</span><span class="params">(String sn)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sn.startsWith(SN_HEADER))&#123;</span><br><span class="line">            <span class="keyword">return</span> sn.substring(SN_HEADER.length());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¶ˆæ¯æ¥å—è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UdpDemo2;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPProvide</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">PROVIDE_LISTEN_PORT</span> <span class="operator">=</span> <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sn</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">Provider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Provider</span>(sn);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(provider).start();</span><br><span class="line">        System.in.read();</span><br><span class="line">        provider.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Provider</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">isDone</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> String sn;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Provider</span><span class="params">(String sn)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.sn = sn;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;UDPProvide is start....&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(PROVIDE_LISTEN_PORT);</span><br><span class="line">                <span class="keyword">while</span> (!isDone) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    <span class="comment">//æ„å»ºæ¥å—çš„ DatagramPacket</span></span><br><span class="line">                    <span class="type">DatagramPacket</span> <span class="variable">udp_receive</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);</span><br><span class="line">                    <span class="comment">//æ¥å— DatagramPacket ï¼ˆé˜»å¡ï¼‰</span></span><br><span class="line">                    socket.receive(udp_receive);</span><br><span class="line">                    <span class="comment">//è·å–å‘é€äººçš„ SocketAddress</span></span><br><span class="line">                    <span class="type">InetSocketAddress</span> <span class="variable">socketAddress</span> <span class="operator">=</span> (InetSocketAddress) udp_receive.getSocketAddress();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">datalen</span> <span class="operator">=</span> udp_receive.getLength();</span><br><span class="line">                    <span class="comment">//è·å–å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">receive</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(udp_receive.getData(), <span class="number">0</span>, datalen);</span><br><span class="line">                    <span class="comment">//æ‰“å°è·å–åˆ°çš„æ•°æ®</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;receive from the: &quot;</span> + socketAddress);</span><br><span class="line">                    System.out.println(<span class="string">&quot;receive data: &quot;</span> + receive);</span><br><span class="line">                    <span class="comment">//è§£æ sn, è·å–éœ€è¦å›é€çš„ç«¯å£</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> MessageCreator.parsePort(receive);</span><br><span class="line">                    <span class="keyword">if</span> (port != -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">//æ„å»ºå›é€çš„ DatagramPacket</span></span><br><span class="line">                        <span class="type">byte</span>[] responseBody = MessageCreator.buildWithSn(sn).getBytes();</span><br><span class="line">                        <span class="type">DatagramPacket</span> <span class="variable">udp_sendBack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(responseBody, <span class="number">0</span>, responseBody.length, socketAddress.getAddress(), port);</span><br><span class="line">                        socket.send(udp_sendBack);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="comment">// e.printStackTrace();</span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                closeRes();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ç»“æŸ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;UDPProvide Finished.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">            isDone = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//è¿™é‡Œä»…ä»… isDone=true è¿œè¿œä¸å¤Ÿï¼Œå› ä¸º socket.receive æ˜¯ä¸€ä¸ªæ°¸ä¹…é˜»å¡çš„æ–¹æ³•</span></span><br><span class="line">            <span class="comment">//æ‰€ä»¥ä¸‹é¢è¿˜è¦ close è¿™ä¸ª socket è¿™æ ·å°±ä¼šæ•è·åˆ°ä¸€ä¸ªå¼‚å¸¸ç„¶åç»“æŸ</span></span><br><span class="line">            closeRes();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">closeRes</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="literal">null</span>) &#123;</span><br><span class="line">                socket.close();</span><br><span class="line">                socket = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¸Šé¢ä¸åŒçš„æ˜¯è¿™é‡Œä¸ºäº†éšæ—¶å¯ä»¥åœæ­¢å°†å…¶æ„å»ºæˆäº†å¼‚æ­¥çº¿ç¨‹ï¼Œå½“æ¥å—åˆ°ç»ˆæ­¢ä¿¡å·çš„æ—¶å€™å°±ä¼šæ”¹å˜çŠ¶æ€é‡ï¼Œå¹¶ close èµ„æºï¼Œç„¶ååˆ©ç”¨å¼‚å¸¸åœæ­¢çº¿ç¨‹ã€‚</p>
<p><strong>æ¶ˆæ¯å‘é€è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UdpDemo2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPSearch</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SEARCH_LISTEN_PORT</span> <span class="operator">=</span> <span class="number">30000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UDPSearch is start...&quot;</span>);</span><br><span class="line">        <span class="type">Listener</span> <span class="variable">listen</span> <span class="operator">=</span> listen();</span><br><span class="line">        sendBoard();</span><br><span class="line">        System.in.read();</span><br><span class="line">        List&lt;Device&gt; devices = listen.closeAndGetDeviceList();</span><br><span class="line">        <span class="keyword">for</span> (Device device : devices) &#123;</span><br><span class="line">            System.out.println(device);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Listener <span class="title function_">listen</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UDPSearch Listener is start&quot;</span>);</span><br><span class="line">        CountDownLatch countDownLatch=<span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>);</span><br><span class="line">        Listener listener=<span class="keyword">new</span> <span class="title class_">Listener</span>(SEARCH_LISTEN_PORT,countDownLatch);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(listener).start();</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        <span class="keyword">return</span> listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendBoard</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„ç«¯å£</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();</span><br><span class="line">        <span class="comment">//æ„å»º socket</span></span><br><span class="line">        <span class="type">byte</span>[] buff = MessageCreator.buildWithPort(SEARCH_LISTEN_PORT).getBytes();</span><br><span class="line">        <span class="comment">//æ„å»ºå‘é€æ®µ</span></span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">udp_send</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buff, buff.length);</span><br><span class="line">        <span class="comment">//å¹¿æ’­åœ°å€</span></span><br><span class="line">        udp_send.setAddress(InetAddress.getByName(<span class="string">&quot;255.255.255.255&quot;</span>));</span><br><span class="line">        <span class="comment">//æ¥æ”¶æ–¹çš„ç«¯å£</span></span><br><span class="line">        udp_send.setPort(UDPProvide.PROVIDE_LISTEN_PORT);</span><br><span class="line">        socket.send(udp_send);</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;UDPSearch Board is over&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">        <span class="type">int</span> port;</span><br><span class="line">        String ip;</span><br><span class="line">        String sn;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Device</span><span class="params">(<span class="type">int</span> port, String ip, String sn)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.port = port;</span><br><span class="line">            <span class="built_in">this</span>.ip = ip;</span><br><span class="line">            <span class="built_in">this</span>.sn = sn;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Device&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;port=&quot;</span> + port +</span><br><span class="line">                    <span class="string">&quot;, ip=&#x27;&quot;</span> + ip + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, sn=&#x27;&quot;</span> + sn + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Listener</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> listenPort;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CountDownLatch countDownLatch;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Device&gt; deviceList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Device&gt;();</span><br><span class="line">        <span class="comment">//private static DatagramSocket socket = null;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isDone</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Listener</span><span class="params">(<span class="type">int</span> listenPort, CountDownLatch countDownLatch)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.listenPort = listenPort;</span><br><span class="line">            <span class="built_in">this</span>.countDownLatch = countDownLatch;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">//é€šçŸ¥å·²ç»å¯åŠ¨</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(listenPort);</span><br><span class="line">                <span class="keyword">while</span> (!isDone) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    <span class="comment">//æ„å»ºæ¥å—çš„ DatagramPacket</span></span><br><span class="line">                    <span class="type">DatagramPacket</span> <span class="variable">udp_receive</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);</span><br><span class="line">                    <span class="comment">//æ¥å— DatagramPacket ï¼ˆé˜»å¡ï¼‰</span></span><br><span class="line">                    socket.receive(udp_receive);</span><br><span class="line">                    <span class="comment">//è·å–å‘é€äººçš„ SocketAddress</span></span><br><span class="line">                    <span class="type">InetSocketAddress</span> <span class="variable">socketAddress</span> <span class="operator">=</span> (InetSocketAddress) udp_receive.getSocketAddress();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">datalen</span> <span class="operator">=</span> udp_receive.getLength();</span><br><span class="line">                    <span class="comment">//è·å–å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">sn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(udp_receive.getData(), <span class="number">0</span>, datalen);</span><br><span class="line">                    System.out.println(<span class="string">&quot;back from theï¼š&quot;</span> + socketAddress);</span><br><span class="line">                    System.out.println(<span class="string">&quot;back dataï¼š&quot;</span> + sn);</span><br><span class="line">                    sn=MessageCreator.parseSn(sn);</span><br><span class="line">                    <span class="keyword">if</span> (sn != <span class="literal">null</span>) &#123;</span><br><span class="line">                        deviceList.add(<span class="keyword">new</span> <span class="title class_">Device</span>(socketAddress.getPort(), socketAddress.getAddress().toString(), sn));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">               <span class="comment">//e.printStackTrace();</span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                closeRes();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;UDPSearch Listener is Finished...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">closeRes</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="literal">null</span>) &#123;</span><br><span class="line">                socket.close();</span><br><span class="line">                socket = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Device&gt; <span class="title function_">closeAndGetDeviceList</span><span class="params">()</span> &#123;</span><br><span class="line">            isDone = <span class="literal">true</span>;</span><br><span class="line">            closeRes();</span><br><span class="line">            <span class="keyword">return</span> deviceList;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯å¹¿æ’­çš„åœ°å€** 255.255.255.255**</p>
<blockquote>
<p>å¦‚æœæ˜¯åœ¨å±€åŸŸç½‘å†…å’Œå…¶ä»–æœºå™¨é€šä¿¡éœ€è¦å…³é—­è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œä¸ç„¶æ˜¯èµ°çš„è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œå…¶ä»–æœºå™¨æ¥æ”¶ä¸åˆ°ã€‚ï¼ˆæˆ‘è¯´æ€ä¹ˆå‘é€çš„** IP <strong>ä¸æ˜¯æˆ‘çš„æœ¬æœºçš„</strong> IP**)</p>
</blockquote>
<p>ğŸ”¸UDP æ˜¯é¢å‘æ— è¿æ¥çš„é€šè®¯åè®®ï¼ŒåŸºäºç”¨æˆ·æ•°æ®æŠ¥çš„åè®®</p>
<p>ğŸ”¸UDP æ•°æ®åŒ…æ‹¬ç›®çš„ç«¯å£å·å’Œæºç«¯å£å·ä¿¡æ¯</p>
<p>ğŸ”¸é€šè®¯ä¸éœ€è¦è¿æ¥ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¹¿æ’­å‘é€ï¼Œå¹¶ä¸å±€é™äºç«¯åˆ°ç«¯</p>
<p>ğŸ”¸ç»“æ„ç®€å•ï¼Œæ— æ ¡éªŒï¼Œé€Ÿåº¦å¿«ï¼Œå®¹æ˜“ä¸¢åŒ…ï¼Œå¯å¹¿æ’­</p>
<p>ğŸ”¸ä»–ä¸€æ—¦æŠŠåº”ç”¨ç¨‹åºå‘ç»™ç½‘ç»œå±‚çš„æ•°æ®å‘é€å‡ºå»å°±ä¸ä¿ç•™æ•°æ®å¤‡ä»½</p>
<h3 id="UDP-è¾…åŠ©-TCP-å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“"><a href="#UDP-è¾…åŠ©-TCP-å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“" class="headerlink" title="UDP è¾…åŠ© TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“"></a>UDP è¾…åŠ© TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“</h3><p>å®¢æˆ·ç«¯å…ˆåˆ©ç”¨<code>UDP</code>å‘å±€åŸŸç½‘å‘é€å¹¿æ’­ï¼Œç„¶åå¯¹åº”çš„æœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åå°±ä¼šå°†å¯¹åº”çš„<code>TCP</code>çš„ç«¯å£å›é€ç»™å®¢æˆ·ç«¯ï¼Œç„¶åäºŒè€…è¿›è¡Œ TCP çš„åŒå‘é€šä¿¡ï¼Œä»£ç å¤ªå¤šè¿™é‡Œå°±åªæ”¾ä¸€ä¸‹<code>Server</code>ç«¯çš„<code>Handler</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> udp_tcp_concurrency.server.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> udp_tcp_concurrency.utils.CloseUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/17 11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">class</span> <span class="title class_">ClientHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerReadHandler serverReadHandler;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerWriterHandler serverWriterHandle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CloseNotify closeNotify;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClientHandler</span><span class="params">(Socket socket, CloseNotify closeNotify)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">        <span class="built_in">this</span>.serverReadHandler = <span class="keyword">new</span> <span class="title class_">ServerReadHandler</span>(socket.getInputStream());</span><br><span class="line">        <span class="built_in">this</span>.serverWriterHandle = <span class="keyword">new</span> <span class="title class_">ServerWriterHandler</span>(socket.getOutputStream());</span><br><span class="line">        <span class="built_in">this</span>.closeNotify = closeNotify;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š&quot;</span> + socket.getInetAddress() + <span class="string">&quot;portï¼š&quot;</span> + socket.getPort());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        serverWriterHandle.send(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»å¤–ç•Œå…³é—­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        serverReadHandler.stopRead();</span><br><span class="line">        serverWriterHandle.stopWriter();</span><br><span class="line">        CloseUtils.close(socket);</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å·²ç»é€€å‡º&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;address:&quot;</span> + socket.getInetAddress() + <span class="string">&quot;,port:&quot;</span> + socket.getPort());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªæˆ‘å…³é—­---&gt;è‡ªé—­</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">stopByMyself</span><span class="params">()</span> &#123;</span><br><span class="line">        stop();</span><br><span class="line">        closeNotify.onSelfClosed(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯»å–å¹¶æ‰“å°åˆ°å±å¹•ï¼ˆå¯åŠ¨ ClientReadHandle çº¿ç¨‹ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read2Print</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(serverReadHandler).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  å°†å·²ç»å…³é—­çš„ handle æš´éœ²ç»™ TCPServer ç„¶åä» list ä¸­ç§»é™¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CloseNotify</span>&#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">onSelfClosed</span><span class="params">(ClientHandler clientHandler)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœåŠ¡ç«¯ç”¨äºè¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯çš„ Handle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ServerReadHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">done</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> InputStream inputStream;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ServerReadHandler</span><span class="params">(InputStream inputStream)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.inputStream = inputStream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//è¾“å…¥æµè·å–ä¿¡æ¯</span></span><br><span class="line">                <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream));</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> reader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (s == <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å·²ç»æ— æ³•å‘é€æ•°æ®&quot;</span>);</span><br><span class="line">                        <span class="comment">//ç»“æŸå½“å‰ Handle</span></span><br><span class="line">                        ClientHandler.<span class="built_in">this</span>.stopByMyself();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//æ‰“å°åˆ°å±å¹•</span></span><br><span class="line">                    System.out.println(s);</span><br><span class="line">                &#125; <span class="keyword">while</span> (!done);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!done) &#123;</span><br><span class="line">                    <span class="comment">//éæ­£å¸¸å…³é—­</span></span><br><span class="line">                    System.err.println(<span class="string">&quot;è¿æ¥å¼‚å¸¸æ–­å¼€&quot;</span>+e.getMessage());</span><br><span class="line">                    ClientHandler.<span class="built_in">this</span>.stopByMyself();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                CloseUtils.close(inputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stopRead</span><span class="params">()</span> &#123;</span><br><span class="line">            done = <span class="literal">true</span>;</span><br><span class="line">            CloseUtils.close(inputStream);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„ Handle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ServerWriterHandler</span>  &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">done</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> PrintStream printStream;</span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ServerWriterHandler</span><span class="params">(OutputStream outputStream)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.printStream = <span class="keyword">new</span> <span class="title class_">PrintStream</span>(outputStream);</span><br><span class="line">            <span class="comment">//å•ä¾‹çº¿ç¨‹æ± </span></span><br><span class="line">            executorService = Executors.newSingleThreadExecutor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String str)</span> &#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œå¦‚æœä¸ç”¨çº¿ç¨‹æ± </span></span><br><span class="line">            executorService.submit(<span class="keyword">new</span> <span class="title class_">WriteRunnable</span>(str));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ± çš„ Runnable</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">WriteRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">WriteRunnable</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.msg = msg;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(ServerWriterHandler.<span class="built_in">this</span>.done)&#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ServerWriterHandler.<span class="built_in">this</span>.printStream.println(msg);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;write å¼‚å¸¸é€€å‡ºï¼š&quot;</span>+e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stopWriter</span><span class="params">()</span> &#123;</span><br><span class="line">            done = <span class="literal">true</span>;</span><br><span class="line">            CloseUtils.close(printStream);</span><br><span class="line">            executorService.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ä»£ç æ”¾åœ¨ <a target="_blank" rel="noopener" href="https://github.com/imlgw/socketDemo">github</a> æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç”¨äº†ä¸€ä¸ªå•çº¿ç¨‹æ± å»å¤„ç†æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œè¿™é‡Œå…¶å®ç”¨çº¿ç¨‹é€šä¿¡æœºåˆ¶<code>wait/notify</code>ä¹Ÿå¯ä»¥åšåˆ°ä½†æ˜¯ç›¸æ¯”ä½¿ç”¨çº¿ç¨‹æ± ä¼šå¤æ‚è®¸å¤šã€‚</p>
<h3 id="å±€åŸŸç½‘èŠå¤©å®¤å®ç°"><a href="#å±€åŸŸç½‘èŠå¤©å®¤å®ç°" class="headerlink" title="å±€åŸŸç½‘èŠå¤©å®¤å®ç°"></a>å±€åŸŸç½‘èŠå¤©å®¤å®ç°</h3><blockquote>
<p>è¿™é‡Œçš„èŠå¤©å®¤ï¼Œå…¶å®å…³é”®çš„åœ°æ–¹å°±åœ¨äºå¯¹å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯äº¤ç”±æœåŠ¡ç«¯è¿›è¡Œè½¬å‘ã€‚</p>
</blockquote>
<p>åŸºäºä¸Šé¢çš„è¿›è¡Œæ”¹é€ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å›è°ƒæ¥å£</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClientHandleCallBack</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å°†å·²ç»å…³é—­çš„ handle æš´éœ²ç»™ TCPServer ç„¶åä» list ä¸­ç§»é™¤</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">onSelfClosed</span><span class="params">(ClientHandler clientHandler)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å°†æ¶ˆæ¯äº¤ç»™æœåŠ¡å™¨è½¬å‘</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> clientHandler</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">onNewMessageArrived</span><span class="params">(ClientHandler clientHandler,String msg)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¢åŠ ä¸€ä¸ªæ¶ˆæ¯æŠµè¾¾çš„æ¥å£ï¼Œç„¶åä¸ºäº†é¿å…é˜»å¡äº¤ç»™å¼‚æ­¥çš„å•çº¿ç¨‹æ± å»å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onNewMessageArrived</span><span class="params">(ClientHandler clientHandler, String msg)</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;Receive from:&quot;</span>+clientHandler.getClientInfo()+<span class="string">&quot; msg:&quot;</span>+msg);</span><br><span class="line">       forwardThreadPool.submit(()-&gt;&#123;</span><br><span class="line">           <span class="keyword">for</span> (ClientHandler clientHandle : clientHandles) &#123;</span><br><span class="line">               <span class="comment">//è·³è¿‡è‡ªå·±</span></span><br><span class="line">               <span class="keyword">if</span>(clientHandle.equals(clientHandler))&#123;</span><br><span class="line">                   <span class="keyword">continue</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//å¯¹å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">               clientHandle.send(msg);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†ä»£ç  è§ <a target="_blank" rel="noopener" href="https://github.com/imlgw/socketDemo">Github</a></p>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">èµèµ</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="">
        <p> æ„Ÿè°¢é¼“åŠ± </p>
    </div>
</div>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/imlgw">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://imlgw.top">Tadow</a></span>
        <span>/</span>
        
        <span><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/publish/query/indexFirst.action">é„‚ICPå¤‡18011208å·</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json"},"display":{"superSample":2,"width":160,"height":320,"position":"right","hOffset":0,"vOffset":-70},"mobile":{"show":false,"scale":0.2},"log":false});</script></body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://giscus.app/client.js"
  data-repo="imlgw/imlgw.github.io"
  data-repo-id="MDEwOlJlcG9zaXRvcnkxMzMyMDY4NDg="
  data-category="Announcements"
  data-category-id="DIC_kwDOB_CTQM4CQ7v8"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="light"
  data-lang="zh-CN"
  data-loading="lazy"
  crossorigin="anonymous"
  async>
</script>



</html>

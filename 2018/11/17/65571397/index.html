<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="Tadow çš„åšå®¢">
    <meta property="og:type" content="website">
    <meta name="description" content="Tadow çš„åšå®¢">
    <meta name="keyword"  content="Tadow, Resolmi, imlgw, åŠå²›é“ç›’, ç®—æ³•, Java, Golang">
    <link rel="shortcut icon" href="https://fav.farm/ğŸ’­">

    <title>
        
        CAS å•ç‚¹ç™»é™†ç³»ç»Ÿ Demo - Tadow ç¢ç¢å¿µ
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Tadow ç¢ç¢å¿µ" type="application/atom+xml">
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Keep It Simple, Stupid </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="https://static.imlgw.top/blog/20220821160037.png" />
        </div>
        <div class="name">
            <i>Tadow</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <!-- <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>æ ‡ç­¾</span>
                </a>
            </li> -->
            <li >
                <a href="/categories">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>å­˜æ¡£</span>
                </a>
            </li>
            
            <li >
                <a href="/selfhosted">
                    <i class="iconfont icon-guidang1"></i>
                    <span>è‡ªå»º</span>
                </a>
            </li>

            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>æ”¶è—</span>
                </a>
            </li>

            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>å…³äº</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>æœç´¢</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E9%99%86%E7%B3%BB%E7%BB%9F-%E2%80%93CAS"><span class="toc-text">å•ç‚¹ç™»é™†ç³»ç»Ÿ â€“CAS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE-CAS-%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">1. é…ç½® CAS æœåŠ¡ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%99%AE%E9%80%9A%E7%9A%84-web-%E9%A1%B9%E7%9B%AE%E9%9B%86%E6%88%90-CAS"><span class="toc-text">2. æ™®é€šçš„ web é¡¹ç›®é›†æˆ CAS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Spring-%E9%A1%B9%E7%9B%AE%E9%9B%86%E6%88%90-CAS-%E5%92%8C-Spring-security"><span class="toc-text">3. Spring é¡¹ç›®é›†æˆ CAS å’Œ Spring-security</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%95"><span class="toc-text">4. æµ‹è¯•</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">æœç´¢</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Keep It Simple, Stupid </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        CAS å•ç‚¹ç™»é™†ç³»ç»Ÿ Demo
    </div>

    <div class="post-meta">
        <span class="attr">å‘å¸ƒäºï¼š<span>2018-11-17 00:00:00</span></span>
        
        <span class="attr">æ ‡ç­¾ï¼š/
        
        <a class="tag" href="/tags/#CAS" title="CAS">CAS</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#SSO" title="SSO">SSO</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">è®¿é—®ï¼š<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h2 id="å•ç‚¹ç™»é™†ç³»ç»Ÿ-â€“CAS"><a href="#å•ç‚¹ç™»é™†ç³»ç»Ÿ-â€“CAS" class="headerlink" title="å•ç‚¹ç™»é™†ç³»ç»Ÿ â€“CAS"></a>å•ç‚¹ç™»é™†ç³»ç»Ÿ â€“CAS</h2><ul>
<li>å…³äº CAS çš„ä»‹ç»ç½‘ä¸Šéƒ½æœ‰ã€‚è¿™é‡Œä¸»è¦è®°å½•å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚ä½•é…ç½®å’Œé›†æˆä¸€äº›æ¡†æ¶ã€‚</li>
<li>CAS æ¶æ„å›¾<br><img src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/CAS.PNG" alt="OSS"><br>CAS çš„ SSO å®ç°æ–¹å¼å¯ç®€åŒ–ç†è§£ä¸ºï¼š 1 ä¸ª Cookie å’Œ N ä¸ª Session ã€‚ CAS Server åˆ›å»º cookieï¼Œåœ¨æ‰€æœ‰åº”ç”¨è®¤è¯æ—¶ä½¿ç”¨ï¼Œå„åº”ç”¨é€šè¿‡åˆ›å»ºå„è‡ªçš„ Session æ¥æ ‡è¯†ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ã€‚<br>ç”¨ æˆ·åœ¨ä¸€ä¸ªåº”ç”¨éªŒè¯é€šè¿‡åï¼Œä»¥åç”¨æˆ·åœ¨åŒä¸€æµè§ˆå™¨é‡Œè®¿é—®æ­¤åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ä¸­çš„è¿‡æ»¤å™¨ä¼šåœ¨ session é‡Œè¯»å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥å°±ä¸ä¼šå» CAS Server è®¤è¯ã€‚å¦‚æœåœ¨æ­¤æµè§ˆå™¨é‡Œè®¿é—®åˆ«çš„ web åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ä¸­çš„è¿‡æ»¤å™¨åœ¨ session é‡Œè¯»å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ä¼šå» CAS Server çš„ login æ¥å£è®¤è¯ï¼Œä½†è¿™æ—¶ CAS Server ä¼šè¯»å–åˆ°æµè§ˆå™¨ä¼ æ¥çš„ cookie ï¼ˆ TGC ï¼‰ï¼Œæ‰€ä»¥ CAS Server ä¸ä¼šè¦æ±‚ç”¨æˆ·å»ç™»å½•é¡µé¢ç™»å½•ï¼Œåªæ˜¯ä¼šæ ¹æ® service å‚æ•°ç”Ÿæˆä¸€ä¸ª Ticket ï¼Œç„¶åå†å’Œ web åº”ç”¨åšä¸€ä¸ªéªŒ è¯ ticket çš„äº¤äº’è€Œå·²ã€‚</li>
</ul>
<h3 id="1-é…ç½®-CAS-æœåŠ¡ç«¯"><a href="#1-é…ç½®-CAS-æœåŠ¡ç«¯" class="headerlink" title="1. é…ç½® CAS æœåŠ¡ç«¯"></a>1. é…ç½® CAS æœåŠ¡ç«¯</h3><p>ä»ä¸Šé¢çš„æ¶æ„å›¾ä¹Ÿå¯ä»¥å¤§æ¦‚çŸ¥é“ CAS è¿ä½œçš„æ–¹å¼ï¼Œé¦–å…ˆé…ç½®å¥½ CAS çš„ Server ç«¯ï¼Œç›´æ¥å°† CAS çš„ war åŒ…æ‹·åˆ° tomcat çš„ webapp ç›®å½•ä¸‹ç„¶åå¯åŠ¨ tomcat è‡ªåŠ¨è§£å‹å°±å¯ä»¥äº†ï¼Œè¿™é‡Œæˆ‘è®¾ç½®çš„ tomcat çš„ç«¯å£æ˜¯ 8888ï¼Œåœ°å€æ è¾“å…¥ localhost:8888/cas èƒ½çœ‹åˆ° CAS çš„ç™»é™†ç•Œé¢è¯´æ˜éƒ¨ç½²æˆåŠŸ</p>
<ul>
<li><p>å»é™¤ https<br>  CAS é»˜è®¤ä½¿ç”¨çš„æ˜¯ HTTPS åè®®ï¼Œå¦‚æœä½¿ç”¨ HTTPS åè®®éœ€è¦ SSL å®‰å…¨è¯ä¹¦ï¼ˆéœ€å‘ç‰¹å®šçš„æœºæ„ç”³è¯·å’Œè´­ä¹°ï¼‰ ã€‚å¦‚æœå¯¹å®‰å…¨è¦æ±‚ä¸é«˜æˆ–æ˜¯åœ¨å¼€å‘æµ‹è¯•é˜¶æ®µï¼Œå¯ä½¿ç”¨ HTTP åè®®ã€‚æˆ‘ä»¬è¿™é‡Œè®²è§£é€šè¿‡ä¿®æ”¹é…ç½®ï¼Œè®© CAS ä½¿ç”¨ HTTP åè®®ã€‚</p>
<ul>
<li><p>ä¿®æ”¹ cas çš„ WEB-INF/deployerConfigContext.xml æ‰¾åˆ°ä¸‹é¢çš„é…ç½®<br><bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"
p:httpClient-ref="httpClient"/><br>è¿™é‡Œéœ€è¦å¢åŠ å‚æ•° p:requireSecure=â€falseâ€ï¼ŒrequireSecure å±æ€§æ„æ€ä¸ºæ˜¯å¦éœ€è¦å®‰å…¨éªŒè¯ï¼Œå³ HTTPSï¼Œfalse ä¸ºä¸é‡‡ç”¨</p>
</li>
<li><p>ä¿®æ”¹ cas çš„/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml<br>æ‰¾åˆ°ä¸‹é¢é…ç½®<br><bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator"
 p:cookieSecure="true"
 p:cookieMaxAge="-1"
 p:cookieName="CASTGC"
 p:cookiePath="/cas" /></p>
</li>
<li><p>å‚æ•° p:cookieSecure=â€trueâ€ï¼ŒåŒç†ä¸º HTTPS éªŒè¯ç›¸å…³ï¼ŒTRUE ä¸ºé‡‡ç”¨ HTTPS éªŒè¯ï¼ŒFALSE ä¸ºä¸é‡‡ç”¨ https éªŒè¯ã€‚<br>å‚æ•° p:cookieMaxAge=â€-1â€ï¼Œæ˜¯ COOKIE çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œ-1 ä¸ºæ— ç”Ÿå‘½å‘¨æœŸï¼Œå³åªåœ¨å½“å‰æ‰“å¼€çš„çª—å£æœ‰æ•ˆï¼Œå…³é—­æˆ–é‡æ–°æ‰“å¼€å…¶å®ƒçª—å£ï¼Œä»ä¼šè¦æ±‚éªŒè¯ã€‚å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ä¸ºå¤§äº 0 çš„æ•°å­—ï¼Œæ¯”å¦‚ 3600 ç­‰ï¼Œæ„æ€æ˜¯åœ¨ 3600 ç§’å†…ï¼Œæ‰“å¼€ä»»æ„çª—å£ï¼Œéƒ½ä¸éœ€è¦éªŒè¯ã€‚</p>
<p>   æˆ‘ä»¬è¿™é‡Œå°† cookieSecure æ”¹ä¸º false , cookieMaxAge æ”¹ä¸º 3600</p>
</li>
<li><p>ä¿®æ”¹ cas çš„ WEB-INF/spring-configuration/warnCookieGenerator.xml<br>   <bean id="warnCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator"
   p:cookieSecure="true"
   p:cookieMaxAge="-1"
   p:cookieName="CASPRIVACY"
   p:cookiePath="/cas" /><br>æˆ‘ä»¬è¿™é‡Œå°† cookieSecure æ”¹ä¸º false , cookieMaxAge æ”¹ä¸º 3600</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>é…ç½®æ•°æ®æº<ul>
<li><p>cas æœ‰é»˜è®¤çš„å¯†ç ä½†æ˜¯å®é™…ä¸­è‚¯å®šæ˜¯è¦ä»æ•°æ®åº“ä¸­æŸ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½®ä¸‹æ•°æ®æº</p>
</li>
<li><p>ä¿®æ”¹ cas æœåŠ¡ç«¯ä¸­ web-inf ä¸‹ deployerConfigContext.xml ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®</p>
   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span> </span><br><span class="line"> p:driverClass=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line"> p:jdbcUrl=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/pinyougoudb?characterEncoding=utf8&quot;</span></span><br><span class="line"> p:user=<span class="string">&quot;root&quot;</span></span><br><span class="line"> p:password=<span class="string">&quot;123456&quot;</span> /&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;passwordEncoder&quot;</span></span><br><span class="line">class=<span class="string">&quot;org.jasig.cas.authentication.handler.DefaultPasswordEncoder&quot;</span> </span><br><span class="line"> c:encodingAlgorithm=<span class="string">&quot;MD5&quot;</span></span><br><span class="line"> p:characterEncoding=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;dbAuthHandler&quot;</span> </span><br><span class="line"> class=<span class="string">&quot;org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler&quot;</span></span><br><span class="line"> p:dataSource-ref=<span class="string">&quot;dataSource&quot;</span></span><br><span class="line"> p:sql=<span class="string">&quot;select password from tb_user where username = ?&quot;</span></span><br><span class="line"> p:passwordEncoder-ref=<span class="string">&quot;passwordEncoder&quot;</span>/&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶å¼€å§‹éƒ¨åˆ†æ‰¾åˆ°å¦‚ä¸‹é…ç½®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> &lt;bean id=<span class="string">&quot;authenticationManager&quot;</span> class=<span class="string">&quot;org.jasig.cas.authentication.PolicyBasedAuthenticationManager&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg&gt;</span><br><span class="line">            &lt;map&gt;               </span><br><span class="line">                &lt;entry key-ref=<span class="string">&quot;proxyAuthenticationHandler&quot;</span> value-ref=<span class="string">&quot;proxyPrincipalResolver&quot;</span> /&gt;</span><br><span class="line">                &lt;entry key-ref=<span class="string">&quot;primaryAuthenticationHandler&quot;</span> value-ref=<span class="string">&quot;primaryPrincipalResolver&quot;</span> /&gt;</span><br><span class="line">            &lt;/map&gt;</span><br><span class="line">        &lt;/constructor-arg&gt;      </span><br><span class="line">        &lt;property name=<span class="string">&quot;authenticationPolicy&quot;</span>&gt;</span><br><span class="line">            &lt;bean class=<span class="string">&quot;org.jasig.cas.authentication.AnyAuthenticationPolicy&quot;</span> /&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <entry key-ref="primaryAuthenticationHandler" value-ref="primaryPrincipalResolver" />ä¸€å¥æ˜¯ä½¿ç”¨å›ºå®šçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ª bean , å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“è®¤è¯ç”¨æˆ·åå’Œå¯†ç ï¼Œéœ€è¦å°†è¿™å¥æ³¨é‡Šæ‰ã€‚<br>æ·»åŠ ä¸‹é¢è¿™ä¸€å¥é…ç½®</p>
<entry key-ref="dbAuthHandler" value-ref="primaryPrincipalResolver"/></li>
<li><p>å°†ä¸‰ä¸ª jar åŒ…åŠ å…¥åˆ° cas çš„ lib ç›®å½•ä¸‹<br><img src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/casjar.PNG" alt="oss"><br>ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œä¸­é—´çš„é‚£ä¸ªæ˜¯ cas å¯¹ jdbc çš„æ”¯æŒåŒ…</p>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-æ™®é€šçš„-web-é¡¹ç›®é›†æˆ-CAS"><a href="#2-æ™®é€šçš„-web-é¡¹ç›®é›†æˆ-CAS" class="headerlink" title="2. æ™®é€šçš„ web é¡¹ç›®é›†æˆ CAS"></a>2. æ™®é€šçš„ web é¡¹ç›®é›†æˆ CAS</h3><p> æ™®é€šçš„ web é¡¹ç›®ä¹Ÿå°±æ˜¯æ²¡æœ‰ä½¿ç”¨ Spring ä¹‹ç±»çš„æ¡†æ¶è€Œé‡‡ç”¨ web.xml é…ç½®çš„æ™®é€šé¡¹ç›®</p>
<ul>
<li><p>2.1 ä¸ºäº†æ–¹ä¾¿æˆ‘è¿™é‡Œé‡‡ç”¨ maven é…ç½®ï¼Œå…ˆæ·»åŠ ç›¸åº”çš„ä¾èµ–</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!-- cas --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jasig.cas.client&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;cas-client-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.3</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.5</span>&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæ˜¯ cas å®¢æˆ·ç«¯çš„æ ¸å¿ƒåŒ…ï¼Œä¸€ä¸ªæ˜¯ servlet çš„åŒ…ï¼Œå› ä¸ºåé¢ä¼šå†™ä¸€äº› jsp<br>ç„¶åæ·»åŠ  tomcat æ’ä»¶æˆ‘è®¾ç½®çš„ç«¯å£ä¸º 9002</p>
</li>
<li><p>2.2 å› ä¸ºæ˜¯æ™®é€šçš„ web é¡¹ç›®æ‰€ä»¥é…ç½®çš„æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡ web.xml æ¥é…ç½®ï¼Œç›´æ¥ä¸Šé…ç½®</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xmlns=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span><br><span class="line">         version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line">    &lt;!-- ç”¨äºå•ç‚¹é€€å‡ºï¼Œè¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½® --&gt;</span><br><span class="line">    &lt;listener&gt;</span><br><span class="line">        &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;</span><br><span class="line">    &lt;/listener&gt;</span><br><span class="line">    &lt;!-- è¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½®ã€‚ --&gt;</span><br><span class="line">    &lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">    &lt;filter-mapping&gt;</span><br><span class="line">        &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;<span class="comment">/* &lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter-mapping&gt;</span></span><br><span class="line"><span class="comment">    &lt;!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£ç”¨æˆ·çš„è®¤è¯å·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ --&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CASFilter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-class&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/filter-class&gt;</span></span><br><span class="line"><span class="comment">        &lt;init-param&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-value&gt;http://localhost:8888/cas/login&lt;/param-value&gt;</span></span><br><span class="line"><span class="comment">            &lt;!--è¿™é‡Œçš„ server æ˜¯æœåŠ¡ç«¯çš„ IP --&gt;</span></span><br><span class="line"><span class="comment">        &lt;/init-param&gt;</span></span><br><span class="line"><span class="comment">        &lt;init-param&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-name&gt;serverName&lt;/param-name&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-value&gt;http://localhost:9002&lt;/param-value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/init-param&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter-mapping&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CASFilter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter-mapping&gt;</span></span><br><span class="line"><span class="comment">    &lt;!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£å¯¹ Ticket çš„æ ¡éªŒå·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ --&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-class&gt;org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&lt;/filter-class&gt;</span></span><br><span class="line"><span class="comment">        &lt;init-param&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-name&gt;casServerUrlPrefix&lt;/param-name&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-value&gt;http://localhost:8888/cas&lt;/param-value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/init-param&gt;</span></span><br><span class="line"><span class="comment">        &lt;init-param&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-name&gt;serverName&lt;/param-name&gt;</span></span><br><span class="line"><span class="comment">            &lt;param-value&gt;http://localhost:9002&lt;/param-value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/init-param&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter-mapping&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter-mapping&gt;</span></span><br><span class="line"><span class="comment">    &lt;!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£å®ç° HttpServletRequest è¯·æ±‚çš„åŒ…è£¹ï¼Œ æ¯”å¦‚å…è®¸å¼€å‘è€…é€šè¿‡ HttpServletRequest çš„ getRemoteUser() æ–¹æ³•è·å¾— SSO ç™»å½•ç”¨æˆ·çš„ç™»å½•åï¼Œå¯é€‰é…ç½®ã€‚ --&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CAS HttpServletRequest Wrapper Filter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-class&gt;</span></span><br><span class="line"><span class="comment">            org.jasig.cas.client.util.*</span></span><br><span class="line"><span class="comment">        &lt;/filter-class&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter-mapping&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CAS HttpServletRequest Wrapper Filter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter-mapping&gt;</span></span><br><span class="line"><span class="comment">    &lt;!-- è¯¥è¿‡æ»¤å™¨ä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡ org.jasig.cas.client.util.AssertionHolder æ¥è·å–ç”¨æˆ·çš„ç™»å½•åã€‚ æ¯”å¦‚ AssertionHolder.getAssertion().getPrincipal().getName()ã€‚ --&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CAS Assertion Thread Local Filter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-class&gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&lt;/filter-class&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter&gt;</span></span><br><span class="line"><span class="comment">    &lt;filter-mapping&gt;</span></span><br><span class="line"><span class="comment">        &lt;filter-name&gt;CAS Assertion Thread Local Filter&lt;/filter-name&gt;</span></span><br><span class="line"><span class="comment">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter-mapping&gt;</span></span><br><span class="line"><span class="comment">&lt;/web-app&gt;</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç”¨æˆ·è®¤è¯è¿‡æ»¤å™¨ï¼ˆå¿…é€‰ï¼‰<strong>AuthenticationFilter **åœ¨ä¸Šé¢çš„é…ç½®ä¸­éœ€è¦ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯ casServerLoginUrl é¡¾åæ€ä¹‰å°±æ˜¯ CASserver ç™»é™†çš„åœ°å€ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ <a target="_blank" rel="noopener" href="http://localhost:8888/cas/login">http://localhost:8888/cas/login</a> ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯</strong> serverName** , å› ä¸ºç™»é™†æˆåŠŸåè¿˜æ˜¯è¦è¿”å›ä½ å½“å‰çš„åº”ç”¨æ‰€ä»¥éœ€è¦å°†ä½ å½“å‰çš„åº”ç”¨çš„åœ°å€ä¼ é€’ç»™ CASserver æ¯”å¦‚æˆ‘çš„å½“å‰åº”ç”¨ <a target="_blank" rel="noopener" href="http://localhost:9002/">http://localhost:9002/</a></li>
<li>Ticket çš„æ ¡éªŒè¿‡æ»¤å™¨ï¼ˆå¿…é€‰ï¼‰<strong>Cas20ProxyReceivingTicketValidationFilter</strong> ä¸ä¸Šé¢çš„è¿‡æ»¤å™¨ç±»ä¼¼ä¹Ÿéœ€è¦é‚£ä¸¤ä¸ªå‚æ•°ï¼Œ                              é…ç½®äº†è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨ CAS å°±èƒ½æ­£å¸¸è¿è¡Œäº†</li>
<li>å•ç‚¹ç™»å‡ºè¿‡æ»¤å™¨ <strong>SingleSignOutFilter</strong>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç”¨äºå•ç‚¹ç™»å‡º  </li>
<li>å¦å¤–è¿˜æœ‰ä¸¤ä¸ªè¿‡æ»¤å™¨éƒ½æ˜¯ä¸ºäº†è·å–ç™»é™†åé…ç½®çš„è¿‡æ»¤å™¨ï¼Œé…ç½®ä¸€ä¸ªå°±è¡Œã€‚    <h1 id=""><a href="#" class="headerlink" title=""></a></h1></li>
</ul>
</li>
<li><p>2.3 ç¼–å†™ index.jsp(tomcat é»˜è®¤æ‰“å¼€çš„é¡µé¢ï¼‰</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=utf-8&quot;</span></span><br><span class="line">         pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;ä¸€å“ä¼˜è´­&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> é‡‡ç”¨ web.xml é…ç½®çš„æ™®é€šçš„ web æ¨¡å—</span><br><span class="line">&lt;%=request.getRemoteUser()%&gt;</span><br><span class="line"> &lt;a href=<span class="string">&quot;http://localhost:8888/cas/logout?service=http://www.imlgw.top&quot;</span>&gt;é€€å‡ºç™»å½•&lt;/a&gt;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>   å¦‚æœæƒ³è®© cas é€€å‡ºåè·³è½¬åˆ°æŒ‡å®šçš„é¡µé¢è€Œä¸æ˜¯ CAS é»˜è®¤çš„é¡µé¢ä¹Ÿéœ€è¦ä¿®æ”¹é…ç½®<br>   ä¿®æ”¹ cas ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ cas-servlet.xml<br>   <bean id="logoutAction" class="org.jasig.cas.web.flow.LogoutAction"
   p:servicesManager-ref="servicesManager"
   p:followServiceRedirects="${cas.logout.followServiceRedirects:true}"/><br>  å°† cas.logout.followServiceRedirects æ”¹ä¸º true åï¼Œå¯ä»¥åœ¨é€€å‡ºæ—¶è·³è½¬é¡µé¢åˆ°ç›®æ ‡é¡µé¢<br> ç„¶åå°±å¯ä»¥å¯åŠ¨ cas å’Œä½ çš„åº”ç”¨æ¥æµ‹è¯•äº†ã€‚</p>
</li>
<li><p>2.4 æœåŠ¡ç«¯ç•Œé¢æ”¹é€ <br> ä¸Šé¢æµ‹è¯•æˆåŠŸï¼Œä½†æ˜¯çœŸå®çš„æƒ…å†µè‚¯å®šä¸ä¼šç”¨ cas é»˜è®¤çš„é‚£ä¸ªé¡µé¢åšç™»é™†éœ€è¦æ”¹æˆä½ è‡ªå·±çš„ç™»é™†ç•Œé¢ï¼Œç„¶åä½ å½“å‰åº”ç”¨çš„ç™»é™†é¡µé¢å°±æ²¡ç”¨äº†ã€‚</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE &gt;</span><br><span class="line">&lt;%@ page pageEncoding=<span class="string">&quot;UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;spring&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/tags&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;form&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;fn&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/functions&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">		&lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">		&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&#x27;bs/css/bootstrap.min.css&#x27;</span> /&gt;</span><br><span class="line">		&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;js/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">		&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;bs/js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">		&lt;style&gt;</span><br><span class="line">			img &#123;</span><br><span class="line">				height: 200px;</span><br><span class="line">				border-radius: 200px;</span><br><span class="line">			&#125;</span><br><span class="line">			.panel-title&#123;</span><br><span class="line">				text-align: center;</span><br><span class="line">			&#125;</span><br><span class="line">			.login &#123;</span><br><span class="line">				width: 500px;</span><br><span class="line">				height: 400px;</span><br><span class="line">				position: absolute;</span><br><span class="line">				top: <span class="number">20</span>%;</span><br><span class="line">				left: <span class="number">50</span>%;</span><br><span class="line">				margin-left: -250px;</span><br><span class="line">			&#125;</span><br><span class="line">			.sub&#123;</span><br><span class="line">				text-align: center;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&lt;/style&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;div class=<span class="string">&quot;panel panel-primary login&quot;</span>&gt;</span><br><span class="line">			&lt;div class=<span class="string">&quot;panel-heading&quot;</span>&gt;</span><br><span class="line">				&lt;div class=<span class="string">&quot;panel-title&quot;</span>&gt;</span><br><span class="line">					&lt;img src=<span class="string">&quot;images/login.jpg&quot;</span> /&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			&lt;div class=<span class="string">&quot;panel-body&quot;</span>&gt;</span><br><span class="line">				&lt;!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">1</span> --&gt;</span><br><span class="line">				&lt;form:form method=<span class="string">&quot;post&quot;</span> id=<span class="string">&quot;fm1&quot;</span> commandName=<span class="string">&quot;$&#123;commandName&#125;&quot;</span> htmlEscape=<span class="string">&quot;true&quot;</span> class=<span class="string">&quot;sui-form&quot;</span>&gt;</span><br><span class="line">				</span><br><span class="line">					&lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">						&lt;div class=<span class="string">&quot;input-group&quot;</span>&gt;</span><br><span class="line">							&lt;span class=<span class="string">&quot;input-group-addon&quot;</span> id=<span class="string">&quot;basic-addon1&quot;</span>&gt;&lt;span class=<span class="string">&quot;glyphicon glyphicon-user&quot;</span>&gt;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">							&lt;!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">2</span> --&gt;</span><br><span class="line">							&lt;form:input  class=<span class="string">&quot;form-control&quot;</span> aria-describedby=<span class="string">&quot;basic-addon1&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span>  id=<span class="string">&quot;username&quot;</span> size=<span class="string">&quot;25&quot;</span> tabindex=<span class="string">&quot;1&quot;</span> accesskey=<span class="string">&quot;$&#123;userNameAccessKey&#125;&quot;</span> path=<span class="string">&quot;username&quot;</span> autocomplete=<span class="string">&quot;off&quot;</span> htmlEscape=<span class="string">&quot;true&quot;</span> /&gt;</span><br><span class="line">						&lt;/div&gt;</span><br><span class="line">					&lt;/div&gt;</span><br><span class="line">					&lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">						&lt;div class=<span class="string">&quot;input-group&quot;</span>&gt;</span><br><span class="line">							&lt;span class=<span class="string">&quot;input-group-addon&quot;</span> id=<span class="string">&quot;basic-addon1&quot;</span>&gt;&lt;span class=<span class="string">&quot;glyphicon glyphicon-lock&quot;</span>&gt;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">							&lt;!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">3</span> --&gt;</span><br><span class="line">							&lt;form:password class=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;password&quot;</span> aria-describedby=<span class="string">&quot;basic-addon1&quot;</span> id=<span class="string">&quot;password&quot;</span> size=<span class="string">&quot;25&quot;</span> tabindex=<span class="string">&quot;2&quot;</span> path=<span class="string">&quot;password&quot;</span>  accesskey=<span class="string">&quot;$&#123;passwordAccessKey&#125;&quot;</span> htmlEscape=<span class="string">&quot;true&quot;</span> autocomplete=<span class="string">&quot;off&quot;</span> /&gt;</span><br><span class="line">						&lt;/div&gt;</span><br><span class="line">					&lt;/div&gt;</span><br><span class="line">					&lt;div class=<span class="string">&quot;form-group sub&quot;</span>&gt;</span><br><span class="line">						&lt;!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">4</span> ç™»é™†æ¡† --&gt;</span><br><span class="line">						&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;lt&quot;</span> value=<span class="string">&quot;$&#123;loginTicket&#125;&quot;</span> /&gt;</span><br><span class="line">     	 				&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;execution&quot;</span> value=<span class="string">&quot;$&#123;flowExecutionKey&#125;&quot;</span> /&gt;</span><br><span class="line">      					&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_eventId&quot;</span> value=<span class="string">&quot;submit&quot;</span> /&gt;</span><br><span class="line">      					&lt;input class=<span class="string">&quot;btn btn-primary btn-lg&quot;</span> name=<span class="string">&quot;submit&quot;</span> accesskey=<span class="string">&quot;l&quot;</span> value=<span class="string">&quot;ç™»é™†&quot;</span> type=<span class="string">&quot;submit&quot;</span> /&gt;</span><br><span class="line">      					&lt;!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">4</span> é”™è¯¯æç¤ºæ¡† --&gt;</span><br><span class="line">      					&lt;form:errors path=<span class="string">&quot;*&quot;</span> id=<span class="string">&quot;msg&quot;</span> cssClass=<span class="string">&quot;errors&quot;</span> element=<span class="string">&quot;div&quot;</span> htmlEscape=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">					&lt;/div&gt;</span><br><span class="line">				&lt;/form:form&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">	&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>  å¯ä»¥ç›´æ¥å°†ç™»é™†çš„é¡µé¢æ‹·è¿‡æ¥ç„¶ååŠ ä¸ŠæŒ‡ä»¤å†æ ¹æ® cas çš„ç™»é™†é¡µé¢ç¨åŠ ä¿®æ”¹å°±å¯ä»¥äº†</p>
</li>
</ul>
<hr>
<h3 id="3-Spring-é¡¹ç›®é›†æˆ-CAS-å’Œ-Spring-security"><a href="#3-Spring-é¡¹ç›®é›†æˆ-CAS-å’Œ-Spring-security" class="headerlink" title="3. Spring é¡¹ç›®é›†æˆ CAS å’Œ Spring-security"></a>3. Spring é¡¹ç›®é›†æˆ CAS å’Œ Spring-security</h3><ul>
<li>pom ä¾èµ–  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">        &lt;spring.version&gt;<span class="number">4.2</span><span class="number">.0</span>.RELEASE&lt;/spring.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- Spring --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-jms&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--spring-security--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">3.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--é›†æˆåŒ…--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-cas&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--cas--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.jasig.cas.client&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;cas-client-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">3.3</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
  æ·»åŠ  tomcat æ’ä»¶æŒ‡å®šç«¯å£ä¸º 9001</li>
<li>web.xml é…ç½®<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xmlns=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span><br><span class="line">         version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context-param&gt;</span><br><span class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;classpath:spring/spring-*.xml&lt;/param-value&gt;</span><br><span class="line">    &lt;/context-param&gt;</span><br><span class="line">    &lt;listener&gt;</span><br><span class="line">        &lt;listener-class&gt;</span><br><span class="line">            org.springframework.web.context.ContextLoaderListener</span><br><span class="line">        &lt;/listener-class&gt;</span><br><span class="line">    &lt;/listener&gt;</span><br><span class="line"></span><br><span class="line">    &lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">    &lt;filter-mapping&gt;</span><br><span class="line">        &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;<span class="comment">/*&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">    &lt;/filter-mapping&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;/web-app&gt;</span></span><br></pre></td></tr></table></figure>
ä¸»è¦é…ç½® Spring å®¹å™¨å’Œ Spring-security çš„è¿‡æ»¤å™¨</li>
</ul>
<ul>
<li>spring-security.xml é…ç½®<br>å…¶å®å°±æ˜¯æŠŠä¹‹å‰é…ç½®åœ¨ web.xml é‡Œé¢çš„è¿‡æ»¤å™¨é‡‡ç”¨ Spring çš„æ–¹å¼é…ç½®å‡ºæ¥</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans:beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/security&quot;</span></span><br><span class="line">             xmlns:beans=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">             xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;http pattern=<span class="string">&quot;/out.html&quot;</span> security=<span class="string">&quot;none&quot;</span>&gt;&lt;/http&gt;</span><br><span class="line">    &lt;!--   entry-point-ref  å…¥å£ç‚¹å¼•ç”¨ å› ä¸ºç™»é™†äº¤ç»™ cas æˆ–è€…å…¶ä»–çš„ç™»é™†ç³»ç»Ÿï¼Œå°±ä¸ä¼šåœ¨æœ¬ç³»ç»Ÿåšç™»é™†éœ€è¦æŒ‡å®šç™»é™†ç‚¹--&gt;</span><br><span class="line">    &lt;http use-expressions=<span class="string">&quot;false&quot;</span> entry-point-ref=<span class="string">&quot;casProcessingFilterEntryPoint&quot;</span>&gt;</span><br><span class="line">        &lt;intercept-url pattern=<span class="string">&quot;/**&quot;</span> access=<span class="string">&quot;ROLE_USER&quot;</span>/&gt;</span><br><span class="line">        &lt;csrf disabled=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- custom-filter ä¸ºè¿‡æ»¤å™¨ï¼Œ position è¡¨ç¤ºå°†è¿‡æ»¤å™¨æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šï¼Œbefore è¡¨ç¤ºæ”¾åœ¨æŒ‡å®šä½ç½®ä¹‹å‰  ï¼Œafter è¡¨ç¤ºæ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¹‹å  --&gt;</span><br><span class="line">        &lt;custom-filter ref=<span class="string">&quot;casAuthenticationFilter&quot;</span>  position=<span class="string">&quot;CAS_FILTER&quot;</span> /&gt;</span><br><span class="line">        &lt;custom-filter ref=<span class="string">&quot;requestSingleLogoutFilter&quot;</span> before=<span class="string">&quot;LOGOUT_FILTER&quot;</span>/&gt;</span><br><span class="line">        &lt;custom-filter ref=<span class="string">&quot;singleLogoutFilter&quot;</span> before=<span class="string">&quot;CAS_FILTER&quot;</span>/&gt;</span><br><span class="line">    &lt;/http&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- CAS å…¥å£ç‚¹ å¼€å§‹ --&gt;</span><br><span class="line">    &lt;beans:bean id=<span class="string">&quot;casProcessingFilterEntryPoint&quot;</span> class=<span class="string">&quot;org.springframework.security.cas.web.CasAuthenticationEntryPoint&quot;</span>&gt;</span><br><span class="line">        &lt;!-- å•ç‚¹ç™»å½•æœåŠ¡å™¨ç™»å½• URL --&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;loginUrl&quot;</span> value=<span class="string">&quot;http://localhost:8888/cas/login&quot;</span>/&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;serviceProperties&quot;</span> ref=<span class="string">&quot;serviceProperties&quot;</span>/&gt;</span><br><span class="line">    &lt;/beans:bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;beans:bean id=<span class="string">&quot;serviceProperties&quot;</span> class=<span class="string">&quot;org.springframework.security.cas.ServiceProperties&quot;</span>&gt;</span><br><span class="line">        &lt;!--service é…ç½®è‡ªèº«å·¥ç¨‹çš„æ ¹åœ°å€+/login/cas   --&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;service&quot;</span> value=<span class="string">&quot;http://localhost:9001/login/cas&quot;</span>/&gt;</span><br><span class="line">    &lt;/beans:bean&gt;</span><br><span class="line">    &lt;!-- CAS å…¥å£ç‚¹ ç»“æŸ --&gt;</span><br><span class="line">    &lt;!-- è®¤è¯è¿‡æ»¤å™¨ å¼€å§‹ --&gt;</span><br><span class="line">    &lt;beans:bean id=<span class="string">&quot;casAuthenticationFilter&quot;</span> class=<span class="string">&quot;org.springframework.security.cas.web.CasAuthenticationFilter&quot;</span>&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;authenticationManager&quot;</span> ref=<span class="string">&quot;authenticationManager&quot;</span>/&gt;</span><br><span class="line">    &lt;/beans:bean&gt;</span><br><span class="line">    &lt;!-- è®¤è¯ç®¡ç†å™¨ --&gt;</span><br><span class="line">    &lt;authentication-manager alias=<span class="string">&quot;authenticationManager&quot;</span>&gt;</span><br><span class="line">        &lt;authentication-provider  ref=<span class="string">&quot;casAuthenticationProvider&quot;</span>&gt;</span><br><span class="line">        &lt;/authentication-provider&gt;</span><br><span class="line">    &lt;/authentication-manager&gt;</span><br><span class="line">    &lt;!-- è®¤è¯æä¾›è€… --&gt;</span><br><span class="line">    &lt;beans:bean id=<span class="string">&quot;casAuthenticationProvider&quot;</span>     class=<span class="string">&quot;org.springframework.security.cas.authentication.CasAuthenticationProvider&quot;</span>&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;authenticationUserDetailsService&quot;</span>&gt;</span><br><span class="line">            &lt;beans:bean class=<span class="string">&quot;org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper&quot;</span>&gt;</span><br><span class="line">                &lt;beans:constructor-arg ref=<span class="string">&quot;userDetailsService&quot;</span> /&gt;</span><br><span class="line">            &lt;/beans:bean&gt;</span><br><span class="line">        &lt;/beans:property&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;serviceProperties&quot;</span> ref=<span class="string">&quot;serviceProperties&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- ticketValidator ä¸ºç¥¨æ®éªŒè¯å™¨ --&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;ticketValidator&quot;</span>&gt;</span><br><span class="line">            &lt;beans:bean class=<span class="string">&quot;org.jasig.cas.client.validation.Cas20ServiceTicketValidator&quot;</span>&gt;</span><br><span class="line">                &lt;beans:constructor-arg index=<span class="string">&quot;0&quot;</span> value=<span class="string">&quot;http://localhost:8888/cas&quot;</span>/&gt;</span><br><span class="line">            &lt;/beans:bean&gt;</span><br><span class="line">        &lt;/beans:property&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;key&quot;</span> value=<span class="string">&quot;an_id_for_this_auth_provider_only&quot;</span>/&gt;</span><br><span class="line">    &lt;/beans:bean&gt;</span><br><span class="line">    &lt;!-- è®¤è¯ç±» --&gt;</span><br><span class="line">    &lt;beans:bean id=<span class="string">&quot;userDetailsService&quot;</span> class=<span class="string">&quot;top.imlgw.demo.UserDetailServiceImpl&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- è®¤è¯è¿‡æ»¤å™¨ ç»“æŸ --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- å•ç‚¹ç™»å‡º  å¼€å§‹  --&gt;</span><br><span class="line">    &lt;beans:bean id=<span class="string">&quot;singleLogoutFilter&quot;</span> class=<span class="string">&quot;org.jasig.cas.client.session.SingleSignOutFilter&quot;</span>/&gt;</span><br><span class="line">    &lt;!--å…³è”ä¸¤ä¸ªåœ°å€ï¼Œç›¸å½“äºå°è£…äº†å‰é¢çš„åœ°å€--&gt;</span><br><span class="line">    &lt;beans:bean id=<span class="string">&quot;requestSingleLogoutFilter&quot;</span> class=<span class="string">&quot;org.springframework.security.web.authentication.logout.LogoutFilter&quot;</span>&gt;</span><br><span class="line">        &lt;beans:constructor-arg value=<span class="string">&quot;http://localhost:8888/cas/logout?service=http://localhost:9001/out.html&quot;</span>/&gt;</span><br><span class="line">        &lt;beans:constructor-arg&gt;</span><br><span class="line">            &lt;beans:bean class=<span class="string">&quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&quot;</span>/&gt;</span><br><span class="line">        &lt;/beans:constructor-arg&gt;</span><br><span class="line">        &lt;beans:property name=<span class="string">&quot;filterProcessesUrl&quot;</span> value=<span class="string">&quot;/logout/cas&quot;</span>/&gt;</span><br><span class="line">    &lt;/beans:bean&gt;</span><br><span class="line">    &lt;!-- å•ç‚¹ç™»å‡º  ç»“æŸ --&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans:beans&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>userDetailsService ç¼–å†™<br>è¿™æ˜¯ä¸€ä¸ªè®¤è¯ç±»æ˜¯å±äº Spring-security çš„ï¼Œå¦‚æœä¸ä½¿ç”¨ CAS é‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯ç”¨æ¥éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®æ˜¯å¦æ”¾è¡Œçš„ã€‚ä½†æ˜¯æ•´åˆäº† CAS åå°±ä¸ç”¨åœ¨é‡Œé¢åšè®¤è¯äº†ï¼Œåªæ˜¯ä¸ºäº†è¿”å›åé¢çš„è§’è‰²é›†åˆã€‚</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.demo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç»è¿‡è®¤è¯ç±»&quot;</span>);</span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="comment">//æœ€å¼€å§‹æŠŠè¿™é‡Œçš„ role å†™é”™äº†ï¼Œç„¶å cas ç™»é™†æˆåŠŸåä¹Ÿä¸€ç›´è¢« 403 forbidï¼Œå› ä¸º SpringSecurity è®¤è¯æ²¡é€šè¿‡ï¼Œä¸€ç›´æ²¡æ”¾è¡Œ</span></span><br><span class="line">        authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_USER&quot;</span>));</span><br><span class="line">        <span class="comment">//ä¸é€šè¿‡æœ¬é¡¹ç›®åšç™»é™† æ‰€ä»¥å¯†ç æ— æ‰€è°“ï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™å°±å·²ç»ç™»é™†æˆåŠŸäº†</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(username,<span class="string">&quot;&quot;</span>,authorities);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4. æµ‹è¯•"></a>4. æµ‹è¯•</h3><p>å¯åŠ¨æ­å»ºå¥½çš„ä¸¤ä¸ªæœåŠ¡å™¨ï¼Œå’Œ casServerï¼Œç„¶åæµ‹è¯•åœ¨ä¸€ä¸ªåº”ç”¨ç™»é™†åå¦ä¸€ä¸ªèƒ½å¦è¿›å…¥ index é¡µé¢ â€¦..</p>
<hr>
<p>SpringBoot é›†æˆ CAS å’Œ Spring-security çš„åé¢å†è¡¥å……ï¼Œå› ä¸º SpringBoot è¿˜ä¸å¤ªç†Ÿæ‚‰ã€‚</p>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">èµèµ</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="">
        <p> æ„Ÿè°¢é¼“åŠ± </p>
    </div>
</div>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/imlgw">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://imlgw.top">Tadow</a></span>
        <span>/</span>
        
        <span><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/publish/query/indexFirst.action">é„‚ICPå¤‡18011208å·</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json"},"display":{"superSample":2,"width":160,"height":320,"position":"right","hOffset":0,"vOffset":-70},"mobile":{"show":false,"scale":0.2},"log":false});</script></body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://giscus.app/client.js"
  data-repo="imlgw/imlgw.github.io"
  data-repo-id="MDEwOlJlcG9zaXRvcnkxMzMyMDY4NDg="
  data-category="Announcements"
  data-category-id="DIC_kwDOB_CTQM4CQ7v8"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="light"
  data-lang="zh-CN"
  data-loading="lazy"
  crossorigin="anonymous"
  async>
</script>



</html>
